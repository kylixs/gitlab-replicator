# T2: æ‰¹é‡æŸ¥è¯¢æœåŠ¡

**çŠ¶æ€**: âœ… å·²å®Œæˆ (Completed)
**ä¾èµ–**: T1 - æ•°æ®æ¨¡å‹æ‰©å±•
**é¢„è®¡æ—¶é—´**: 2å¤©

---

## ä»»åŠ¡ç›®æ ‡

- å®ç° BatchQueryExecutor æ‰¹é‡æŸ¥è¯¢æœåŠ¡
- æ”¯æŒå¢é‡æŸ¥è¯¢ï¼ˆupdated_after å‚æ•°ï¼‰
- å®ç°å¹¶å‘æŸ¥è¯¢ä¼˜åŒ–
- æ›´æ–°é¡¹ç›®è¡¨çš„ç›‘æ§å­—æ®µ
- å®ç°æŸ¥è¯¢ç»“æœæ‰¹é‡å†™å…¥

---

## å­ä»»åŠ¡

### T2.1 GitLab API æ‰¹é‡æŸ¥è¯¢å°è£…
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**ä»»åŠ¡å†…å®¹**:
- åˆ›å»º `BatchQueryExecutor` æœåŠ¡ç±»
- å®ç° `queryProjects()` æ–¹æ³•
  - æ”¯æŒ `updated_after` å‚æ•°ï¼ˆå¢é‡æŸ¥è¯¢ï¼‰
  - æ”¯æŒ `per_page` åˆ†é¡µå‚æ•°
  - æ”¯æŒ `statistics=true` å‚æ•°ï¼ˆè·å–ä»“åº“å¤§å°ï¼‰
  - æ”¯æŒ `with_custom_attributes=false` ä¼˜åŒ–æ€§èƒ½
- å®ç°åˆ†é¡µå¤„ç†é€»è¾‘
- å¤„ç† GitLab API è¿”å›çš„é¡¹ç›®ä¿¡æ¯:
  - `default_branch`
  - `last_activity_at`
  - `statistics.repository_size`
- å®ç°æŸ¥è¯¢è¶…æ—¶æ§åˆ¶ï¼ˆ30ç§’ï¼‰
- å®ç°é”™è¯¯é‡è¯•ï¼ˆæœ€å¤š3æ¬¡ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- æ‰¹é‡æŸ¥è¯¢æ­£ç¡®æ‰§è¡Œ
- å¢é‡æŸ¥è¯¢å‚æ•°æ­£ç¡®ä¼ é€’
- åˆ†é¡µå¤„ç†æ­£ç¡®ï¼ˆè‡ªåŠ¨è·å–æ‰€æœ‰é¡µï¼‰
- ç»Ÿè®¡ä¿¡æ¯æ­£ç¡®è·å–
- è¶…æ—¶æ§åˆ¶ç”Ÿæ•ˆ
- é”™è¯¯é‡è¯•æ­£ç¡®

**API ç¤ºä¾‹**:
```
GET /api/v4/projects?updated_after=2025-12-14T10:00:00Z&per_page=50&statistics=true
```

---

### T2.2 è·å–é¡¹ç›®è¯¦ç»†ä¿¡æ¯
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**ä»»åŠ¡å†…å®¹**:
- å®ç° `getProjectDetails()` æ–¹æ³•
- è°ƒç”¨ GitLab API è·å–:
  - Branches: `GET /api/v4/projects/:id/repository/branches`
  - Commits: `GET /api/v4/projects/:id/repository/commits`
  - Latest commit SHA: ä» branches ä¸­è·å– default_branch çš„ commit.id
- å®ç°å­—æ®µè§£æ:
  - `latest_commit_sha` - é»˜è®¤åˆ†æ”¯çš„æœ€æ–° commit SHA
  - `commit_count` - commits æ€»æ•°ï¼ˆå¯é€‰ï¼Œæ€§èƒ½è€ƒè™‘ï¼‰
  - `branch_count` - åˆ†æ”¯æ€»æ•°
- å®ç°æ‰¹é‡å¹¶å‘æŸ¥è¯¢ï¼ˆ5ä¸ªå¹¶å‘ï¼‰
- ä½¿ç”¨ CompletableFuture å¼‚æ­¥å¤„ç†

**éªŒæ”¶æ ‡å‡†**:
- é¡¹ç›®è¯¦ç»†ä¿¡æ¯æ­£ç¡®è·å–
- å¹¶å‘æŸ¥è¯¢æ­£ç¡®æ‰§è¡Œ
- commit SHA æ­£ç¡®è§£æ
- åˆ†æ”¯æ•°é‡æ­£ç¡®ç»Ÿè®¡
- å¼‚æ­¥å¤„ç†æ— é˜»å¡

---

### T2.3 æ›´æ–°é¡¹ç›®è¡¨ç›‘æ§å­—æ®µ
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**ä»»åŠ¡å†…å®¹**:
- åˆ›å»º `UpdateProjectDataService` æœåŠ¡ç±»
- å®ç° `updateSourceProjects()` æ–¹æ³•
  - æ‰¹é‡æ›´æ–° SOURCE_PROJECT_INFO ç›‘æ§å­—æ®µ
  - ä½¿ç”¨ MyBatis-Plus æ‰¹é‡æ›´æ–°
- å®ç° `updateTargetProjects()` æ–¹æ³•
  - æ‰¹é‡æ›´æ–° TARGET_PROJECT_INFO ç›‘æ§å­—æ®µ
- å®ç°äº‹åŠ¡æ§åˆ¶
- å®ç°æ›´æ–°ç»“æœç»Ÿè®¡ï¼ˆæˆåŠŸæ•°/å¤±è´¥æ•°ï¼‰
- è®°å½•æ›´æ–°æ—¥å¿—

**æ›´æ–°å­—æ®µ**:
- `latest_commit_sha`
- `commit_count`
- `branch_count`
- `repository_size`
- `last_activity_at`
- `updated_at`

**éªŒæ”¶æ ‡å‡†**:
- æ‰¹é‡æ›´æ–°æ­£ç¡®æ‰§è¡Œ
- äº‹åŠ¡æ­£ç¡®æäº¤/å›æ»š
- æ›´æ–°ç»“æœç»Ÿè®¡å‡†ç¡®
- æ—¥å¿—è®°å½•å®Œæ•´
- æ€§èƒ½è¾¾æ ‡ï¼ˆ1000ä¸ªé¡¹ç›® <10ç§’ï¼‰

---

### T2.4 å¢é‡æŸ¥è¯¢ä¼˜åŒ–
**çŠ¶æ€**: â¸ï¸ å¾…å¤„ç†

**ä»»åŠ¡å†…å®¹**:
- å®ç°å¢é‡æŸ¥è¯¢æ—¶é—´ç®¡ç†
- ä»æ•°æ®åº“è¯»å– `last_scan_time`ï¼ˆå¯å­˜å‚¨åœ¨é…ç½®è¡¨æˆ– Redisï¼‰
- æ„é€  `updated_after` å‚æ•°
- æ›´æ–° `last_scan_time` åˆ°å½“å‰æ—¶é—´
- å®ç°å…¨é‡æŸ¥è¯¢é™çº§é€»è¾‘ï¼ˆå¢é‡å¤±è´¥æ—¶ï¼‰
- å®ç°æŸ¥è¯¢ç»“æœè¿‡æ»¤ï¼ˆæ’é™¤æœªå˜æ›´é¡¹ç›®ï¼‰

**éªŒæ”¶æ ‡å‡†**:
- å¢é‡æŸ¥è¯¢æ—¶é—´æ­£ç¡®ç®¡ç†
- `updated_after` å‚æ•°æ­£ç¡®ä¼ é€’
- å…¨é‡é™çº§é€»è¾‘æ­£ç¡®
- ä»…å¤„ç†å˜æ›´é¡¹ç›®
- API è°ƒç”¨æ¬¡æ•°å‡å°‘ 80-90%

---

### T2.5 å•å…ƒæµ‹è¯•
**çŠ¶æ€**: âœ… å·²å®Œæˆ

**ä»»åŠ¡å†…å®¹**:
- æµ‹è¯•æ‰¹é‡æŸ¥è¯¢ API è°ƒç”¨
- æµ‹è¯•å¢é‡æŸ¥è¯¢å‚æ•°
- æµ‹è¯•é¡¹ç›®è¯¦ç»†ä¿¡æ¯è·å–
- æµ‹è¯•å¹¶å‘æŸ¥è¯¢
- æµ‹è¯•æ‰¹é‡æ›´æ–°
- æµ‹è¯•äº‹åŠ¡å›æ»š
- Mock GitLab API å“åº”

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰æµ‹è¯•é€šè¿‡
- Mock å“åº”æ­£ç¡®
- å¹¶å‘æµ‹è¯•æ— ç«æ€
- äº‹åŠ¡æµ‹è¯•æ­£ç¡®

---

## æäº¤ä¿¡æ¯

```
feat(monitor): implement batch query executor and project update service
```

---

## å‚è€ƒæ–‡æ¡£

- [UNIFIED_PROJECT_MONITOR_DESIGN.md - æ‰¹é‡æŸ¥è¯¢](../UNIFIED_PROJECT_MONITOR_DESIGN.md#ğŸ”„-å…³é”®å¤„ç†æµç¨‹)
- GitLab API æ–‡æ¡£: https://docs.gitlab.com/ee/api/projects.html
