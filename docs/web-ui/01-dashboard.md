# Web UI 模块 1: Dashboard (仪表盘)

**状态**: ⏸️ 待处理 (Pending)

**目标**: 实现系统整体运行状况概览页面，包括统计数据、状态分布、延时监控和活动时间线。

**预计时间**: 2-3天

**相关文档**:
- [Web UI 需求清单](../web-ui-requirements.md#21-dashboard-仪表盘)

---

## ⚠️ 重要提醒：任务状态管理规范

**【必须】在开始处理下面的每个子任务前及后需要修改其任务状态：**

1. **开始任务前**：将任务状态从 `⏸️ 待处理 (Pending)` 修改为 `🔄 进行中 (In Progress)`
2. **完成任务后**：将任务状态修改为 `✅ 已完成 (Completed)` 或 `❌ 失败 (Failed)`
3. **更新位置**：在本文档对应任务的 `**状态**:` 行进行修改

**状态标记说明**：
- `⏸️ 待处理 (Pending)` - 任务未开始
- `🔄 进行中 (In Progress)` - 任务正在处理中
- `✅ 已完成 (Completed)` - 任务成功完成，测试通过
- `❌ 失败 (Failed)` - 任务失败，需要修复
- `⚠️ 阻塞 (Blocked)` - 任务被依赖阻塞

---

## 任务清单

### T1.1 后端 API - Dashboard 统计数据
**状态**: ✅ 已完成 (Completed)
**依赖**: 无

**任务目标**:
- 创建 `DashboardController`
- 实现统计数据 API
- 实现状态分布 API
- 实现延时 Top10 API
- 实现最近活动 API

**API 端点**:
```java
GET /api/dashboard/stats
响应: {
  "totalProjects": 100,
  "syncedProjects": 80,
  "syncingProjects": 5,
  "pausedProjects": 10,
  "failedProjects": 5
}

GET /api/dashboard/status-distribution
响应: {
  "synced": 80,
  "syncing": 5,
  "pending": 0,
  "paused": 10,
  "failed": 5
}

GET /api/dashboard/top-delayed-projects?limit=10
响应: [
  {
    "projectKey": "ai/test-rails-5",
    "syncProjectId": 123,
    "delaySeconds": 259200,
    "delayFormatted": "3天",
    "syncStatus": "outdated"
  }
]

GET /api/dashboard/recent-events?limit=20
响应: 同 /api/sync/events 格式
```

**验收标准**:
- 所有 API 正确返回数据
- 统计数据准确
- 延时计算正确
- 响应时间 < 500ms

**测试要求**:
- 单元测试覆盖所有 Controller 方法
- 测试空数据场景
- 测试性能

**提交**: `feat(web-ui): add dashboard statistics API`

---

### T1.2 前端页面 - Dashboard 布局
**状态**: ⏸️ 待处理
**依赖**: T1.1

**任务目标**:
- 创建 Dashboard 页面组件
- 实现响应式布局
- 实现统计卡片组件
- 实现图表容器

**组件结构**:
```
views/Dashboard.vue
├─ components/
│  ├─ StatCard.vue         # 统计卡片
│  ├─ StatusChart.vue      # 状态分布图
│  ├─ DelayedTable.vue     # 延时Top10表格
│  └─ ActivityTimeline.vue # 活动时间线
```

**验收标准**:
- 页面布局合理
- 响应式适配桌面和平板
- 统计卡片正确显示
- 图表容器正确占位

**测试要求**:
- 组件单元测试
- 响应式测试（不同屏幕尺寸）

**提交**: `feat(web-ui): add dashboard layout and components`

---

### T1.3 前端功能 - 统计卡片
**状态**: ⏸️ 待处理
**依赖**: T1.2

**任务目标**:
- 实现统计卡片数据获取
- 实现状态颜色标识
- 实现数据自动刷新
- 实现 Loading 状态

**功能需求**:
- 5个统计卡片（总数、已同步、同步中、暂停、失败）
- 颜色编码（绿/蓝/灰/红）
- 每30秒自动刷新
- 点击卡片跳转到对应筛选的项目列表

**验收标准**:
- 数据正确显示
- 颜色标识正确
- 自动刷新生效
- 点击跳转正确

**测试要求**:
- 数据获取测试
- 刷新逻辑测试
- 跳转测试

**提交**: `feat(web-ui): implement dashboard stat cards`

---

### T1.4 前端功能 - 状态分布图
**状态**: ⏸️ 待处理
**依赖**: T1.2

**任务目标**:
- 集成 ECharts
- 实现饼图/柱状图
- 实现数据绑定
- 实现图表交互

**功能需求**:
- 使用 ECharts 绘制状态分布
- 支持饼图和柱状图切换
- 颜色与状态一致
- 鼠标悬停显示详情

**验收标准**:
- 图表正确渲染
- 数据正确绑定
- 颜色标识一致
- 交互流畅

**测试要求**:
- 图表渲染测试
- 数据更新测试

**提交**: `feat(web-ui): add status distribution chart`

---

### T1.5 前端功能 - 延时 Top10
**状态**: ⏸️ 待处理
**依赖**: T1.2

**任务目标**:
- 实现延时项目表格
- 实现延时时间格式化
- 实现颜色编码
- 实现快速操作

**功能需求**:
- 表格显示延时最严重的10个项目
- 延时时间智能格式化（分钟/小时/天）
- 延时颜色编码（绿/黄/红）
- 快速操作：查看详情、立即同步

**验收标准**:
- 表格正确显示
- 时间格式化正确
- 颜色编码准确
- 操作按钮生效

**测试要求**:
- 数据渲染测试
- 时间格式化测试
- 操作测试

**提交**: `feat(web-ui): add top delayed projects table`

---

### T1.6 前端功能 - 活动时间线
**状态**: ⏸️ 待处理
**依赖**: T1.2

**任务目标**:
- 实现活动时间线组件
- 实现事件类型筛选
- 实现自动刷新
- 实现事件详情跳转

**功能需求**:
- 显示最近20条同步事件
- 事件类型图标和颜色
- 支持按类型筛选
- 点击跳转到同步事件页

**验收标准**:
- 时间线正确显示
- 筛选功能生效
- 自动刷新生效
- 跳转正确

**测试要求**:
- 数据渲染测试
- 筛选测试
- 跳转测试

**提交**: `feat(web-ui): add activity timeline`

---

### T1.7 前端功能 - 扫描操作
**状态**: ⏸️ 待处理
**依赖**: T1.2

**任务目标**:
- 实现全量扫描按钮
- 实现增量扫描按钮
- 实现操作确认
- 实现操作反馈

**功能需求**:
- 触发全量/增量扫描
- 操作前确认对话框
- 操作成功/失败提示
- 按钮 Loading 状态

**验收标准**:
- 扫描触发成功
- 确认对话框正确
- 提示信息准确
- Loading 状态正确

**测试要求**:
- 扫描触发测试
- 确认对话框测试
- 提示测试

**提交**: `feat(web-ui): add scan trigger buttons`

---

## 模块输出

- ✅ DashboardController (后端)
- ✅ Dashboard 页面和子组件 (前端)
- ✅ 统计卡片
- ✅ 状态分布图
- ✅ 延时 Top10 表格
- ✅ 活动时间线
- ✅ 扫描操作

---

## 关键决策

1. **自动刷新**: 统计数据每30秒刷新一次，避免频繁请求
2. **图表库**: 使用 ECharts，功能强大且易于定制
3. **颜色系统**: 统一使用状态颜色（绿/蓝/黄/灰/红）
4. **性能优化**: 后端 API 使用缓存（5分钟 TTL）

---

## UI/UX 规范

**颜色编码**:
- 已同步/成功: `#52c41a` (绿色)
- 同步中: `#1890ff` (蓝色)
- 警告: `#faad14` (黄色)
- 暂停: `#8c8c8c` (灰色)
- 失败/错误: `#f5222d` (红色)

**延时颜色**:
- < 1小时: 绿色
- 1-24小时: 黄色
- \> 24小时: 红色
- 实时: 蓝色

---

## 注意事项

1. **数据刷新**: 避免过于频繁的刷新，注意性能
2. **缓存策略**: 后端统计数据使用短期缓存
3. **响应式**: 确保在不同屏幕尺寸下正常显示
4. **错误处理**: API 失败时显示友好提示
5. **权限控制**: 扫描操作需要管理员权限（后续实现）
