# Web UI 模块 2: Projects List (项目列表)

**状态**: ⏸️ 待处理 (Pending)

**目标**: 实现项目列表页面，支持筛选、搜索、排序、批量操作和差异显示。

**预计时间**: 3-4天

**相关文档**:
- [Web UI 需求清单](../web-ui-requirements.md#22-projects-项目列表)

---

## ⚠️ 重要提醒：任务状态管理规范

**【必须】在开始处理下面的每个子任务前及后需要修改其任务状态：**

1. **开始任务前**：将任务状态从 `⏸️ 待处理 (Pending)` 修改为 `🔄 进行中 (In Progress)`
2. **完成任务后**：将任务状态修改为 `✅ 已完成 (Completed)` 或 `❌ 失败 (Failed)`
3. **更新位置**：在本文档对应任务的 `**状态**:` 行进行修改

---

## 任务清单

### T2.1 后端 API - 项目列表扩展
**状态**: ✅ 已完成 (Completed)
**依赖**: 无

**任务目标**:
- 扩展 `/api/sync/projects` API
- 实现差异计算逻辑
- 实现延时计算逻辑
- 实现筛选、搜索、排序
- 实现 Groups 列表 API

**API 增强**:
```java
GET /api/sync/projects?page=1&size=20&status=&syncMethod=&group=&delayRange=&search=&sortBy=delay&sortOrder=desc
响应: {
  "success": true,
  "data": {
    "items": [
      {
        "id": 123,
        "projectKey": "ai/test-rails-5",
        "syncStatus": "synced",
        "syncMethod": "pull_sync",
        "lastSyncAt": "2025-12-23T14:30:25",
        "updatedAt": "2025-12-23T14:35:10",
        "diff": {
          "branchNew": 3,
          "branchDeleted": 1,
          "branchOutdated": 2,
          "commitDiff": 125
        },
        "delaySeconds": 300,
        "delayFormatted": "5分钟"
      }
    ],
    "total": 100,
    "page": 1,
    "size": 20
  }
}

GET /api/sync/projects/groups
响应: ["ai", "devops", "backend", "frontend"]
```

**差异计算**:
- 分支差异: 从 `project_branch_snapshot` 计算
- Commit差异: `source_commit_count - target_commit_count`

**延时计算**:
- `source.last_activity_at - target.last_activity_at`

**验收标准**:
- 筛选功能正确
- 搜索功能正确
- 排序功能正确
- 差异计算准确
- 延时计算准确
- 分页正确

**测试要求**:
- 单元测试所有筛选条件
- 测试排序逻辑
- 测试差异计算
- 测试性能（大数据量）

**提交**: `feat(web-ui): extend projects list API with filters`

---

### T2.2 后端 API - 批量操作
**状态**: ✅ 已完成 (Completed)
**依赖**: T2.1

**任务目标**:
- 实现批量同步 API
- 实现批量暂停 API
- 实现批量恢复 API
- 实现批量删除 API

**API 端点**:
```java
POST /api/sync/projects/batch-sync
请求: { "projectIds": [1, 2, 3] }
响应: { "success": true, "message": "已提交3个同步任务" }

POST /api/sync/projects/batch-pause
请求: { "projectIds": [1, 2, 3] }
响应: { "success": true, "message": "已暂停3个项目" }

POST /api/sync/projects/batch-resume
请求: { "projectIds": [1, 2, 3] }
响应: { "success": true, "message": "已恢复3个项目" }

POST /api/sync/projects/batch-delete
请求: { "projectIds": [1, 2, 3] }
响应: { "success": true, "message": "已删除3个项目" }
```

**验收标准**:
- 批量操作正确执行
- 事务处理正确
- 错误处理完善
- 部分失败返回详情

**测试要求**:
- 测试批量操作
- 测试事务回滚
- 测试错误场景

**提交**: `feat(web-ui): add batch operations API`

---

### T2.3 前端页面 - 项目列表布局
**状态**: ✅ 已完成 (Completed)
**依赖**: T2.1

**任务目标**:
- 创建 Projects 页面组件
- 实现表格布局
- 实现筛选器组件
- 实现批量操作栏

**组件结构**:
```
views/Projects.vue
├─ components/
│  ├─ ProjectTable.vue      # 项目表格
│  ├─ FilterBar.vue         # 筛选器
│  ├─ BatchOperationBar.vue # 批量操作栏
│  ├─ ProjectRow.vue        # 表格行
│  └─ DiffBadge.vue         # 差异徽章
```

**验收标准**:
- 页面布局合理
- 表格正确显示
- 筛选器位置正确
- 批量操作栏显示正确

**测试要求**:
- 组件单元测试
- 布局测试

**提交**: `feat(web-ui): add projects list layout`

---

### T2.4 前端功能 - 表格展示
**状态**: ⏸️ 待处理
**依赖**: T2.3

**任务目标**:
- 实现表格数据绑定
- 实现状态徽章显示
- 实现差异显示
- 实现延时显示
- 实现分页

**表格列**:
- 项目路径
- 同步状态（徽章）
- 差异（分支 +/-/~, Commit +N）
- 同步延时（智能时间 + 颜色）
- 同步方式
- 最后同步时间
- 更新时间
- 操作按钮

**验收标准**:
- 表格正确显示所有列
- 状态徽章颜色正确
- 差异格式正确
- 延时颜色编码正确
- 分页功能正确

**测试要求**:
- 数据渲染测试
- 分页测试
- 格式化测试

**提交**: `feat(web-ui): implement project table display`

---

### T2.5 前端功能 - 筛选和搜索
**状态**: ⏸️ 待处理
**依赖**: T2.4

**任务目标**:
- 实现 Group 筛选
- 实现状态筛选
- 实现同步方式筛选
- 实现延时范围筛选
- 实现搜索框

**功能需求**:
- Group 多选下拉框
- 状态多选（6种状态）
- 同步方式单选
- 延时范围单选（<1h/1-24h/1-7d/>7d）
- 搜索框（项目名/路径）

**验收标准**:
- 筛选器正确工作
- 多选/单选正确
- 搜索功能正确
- 筛选条件联合生效

**测试要求**:
- 筛选功能测试
- 搜索测试
- 组合筛选测试

**提交**: `feat(web-ui): add filters and search`

---

### T2.6 前端功能 - 排序
**状态**: ⏸️ 待处理
**依赖**: T2.4

**任务目标**:
- 实现表头排序
- 实现排序指示器
- 实现排序状态保持

**排序字段**:
- 延时（默认降序）
- 更新时间
- 项目名
- 最后同步时间

**验收标准**:
- 点击表头触发排序
- 排序指示器正确显示
- 升序/降序正确
- 排序状态保持（刷新后）

**测试要求**:
- 排序功能测试
- 状态保持测试

**提交**: `feat(web-ui): add table sorting`

---

### T2.7 前端功能 - 批量操作
**状态**: ⏸️ 待处理
**依赖**: T2.2, T2.4

**任务目标**:
- 实现全选/取消全选
- 实现批量同步
- 实现批量暂停/恢复
- 实现批量删除
- 实现操作确认

**功能需求**:
- 复选框选择
- 批量操作按钮
- 操作前确认对话框
- 操作进度提示
- 操作结果反馈

**验收标准**:
- 全选功能正确
- 批量操作正确执行
- 确认对话框显示
- 进度提示准确
- 结果反馈清晰

**测试要求**:
- 选择功能测试
- 批量操作测试
- 确认测试

**提交**: `feat(web-ui): add batch operations`

---

### T2.8 前端功能 - 单个项目操作
**状态**: ⏸️ 待处理
**依赖**: T2.4

**任务目标**:
- 实现查看详情按钮
- 实现立即同步按钮
- 实现暂停/恢复按钮
- 实现删除按钮

**功能需求**:
- 操作按钮根据状态显示/禁用
- 点击跳转到详情页
- 触发同步操作
- 确认删除对话框

**验收标准**:
- 按钮状态正确
- 跳转正确
- 操作触发成功
- 确认对话框显示

**测试要求**:
- 按钮状态测试
- 操作测试
- 跳转测试

**提交**: `feat(web-ui): add project action buttons`

---

### T2.9 前端功能 - 导出列表
**状态**: ⏸️ 待处理
**依赖**: T2.4

**任务目标**:
- 实现导出按钮
- 实现 CSV 格式导出
- 实现当前筛选结果导出

**功能需求**:
- 导出按钮
- 导出当前筛选的数据
- CSV 格式包含所有列

**验收标准**:
- 导出功能正确
- CSV 格式正确
- 筛选结果正确导出

**测试要求**:
- 导出功能测试
- CSV 格式验证

**提交**: `feat(web-ui): add export functionality`

---

## 模块输出

- ✅ 项目列表 API 扩展
- ✅ 批量操作 API
- ✅ Projects 页面和子组件
- ✅ 表格展示（含差异和延时）
- ✅ 筛选和搜索
- ✅ 排序功能
- ✅ 批量操作
- ✅ 单个项目操作
- ✅ 导出列表

---

## 关键决策

1. **差异计算**: 后端计算，避免前端重复计算
2. **延时颜色**: 统一使用颜色编码（绿/黄/红/蓝）
3. **批量操作**: 使用事务确保数据一致性
4. **筛选条件**: 支持多个筛选器联合使用
5. **排序**: 默认按延时降序，突出问题项目

---

## 性能优化

1. **分页**: 默认每页 20 条
2. **缓存**: 差异数据实时计算（已移除缓存）
3. **索引**: 确保数据库筛选字段有索引
4. **虚拟滚动**: 大数据量时使用虚拟滚动（可选）

---

## 注意事项

1. **权限**: 批量删除需要二次确认
2. **状态更新**: 操作后实时更新列表
3. **错误处理**: 批量操作部分失败时提示详情
4. **性能**: 筛选和排序在后端完成
5. **响应式**: 表格在小屏幕下可横向滚动
