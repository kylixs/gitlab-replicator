#!/bin/bash
#
# GitLab Mirror CLI - Command Line Interface
#

set -e

# Get script directory
SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
CLI_HOME="$(cd "$SCRIPT_DIR/.." && pwd)"
APP_HOME="$(cd "$CLI_HOME/.." && pwd)"

# Configuration
LIB_DIR="$CLI_HOME/lib"
ENV_FILE="$APP_HOME/conf/.env"

# Java options for CLI (lighter than server)
JAVA_OPTS="${JAVA_OPTS:--Xms128m -Xmx512m}"

# Load environment variables
if [ -f "$ENV_FILE" ]; then
    set -a
    source "$ENV_FILE"
    set +a
fi

# Find JAR file in lib directory
JAR_FILE=$(find "$LIB_DIR" -maxdepth 1 -name "*.jar" -type f | head -n 1)

# Check JAR file exists
if [ -z "$JAR_FILE" ] || [ ! -f "$JAR_FILE" ]; then
    echo "Error: No JAR file found in $LIB_DIR"
    exit 1
fi

# Execute CLI with all arguments
java $JAVA_OPTS -jar "$JAR_FILE" "$@"
