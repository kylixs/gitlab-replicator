import{d as K,c as x,w as t,r as n,b as e,a as o,t as _,o as h,_ as N,f as V,y as B,g as le,z as oe,j as m,h as de,i as ie,k as T,B as ce,C as re,E as q,D as ue,G as _e,e as pe,l as G,x as ve,I as W,q as me,J as I}from"./index-WE4AwvtF.js";import{c as P}from"./client-C0jSVIxo.js";const fe={class:"stat-item"},ye={class:"stat-icon primary"},he={class:"stat-info"},ge={class:"stat-value"},be={class:"stat-item"},Se={class:"stat-icon success"},De={class:"stat-info"},we={class:"stat-value"},Ve={class:"stat-item"},Ee={class:"stat-icon danger"},Te={class:"stat-info"},ke={class:"stat-value"},Ce={class:"stat-item"},$e={class:"stat-icon info"},xe={class:"stat-info"},ze={class:"stat-value"},Me=K({__name:"EventStats",props:{stats:{}},setup(v){const k=p=>{if(!p)return"0s";if(p<1e3)return`${p}ms`;const i=Math.floor(p/1e3);if(i<60)return`${i}s`;const g=Math.floor(i/60),a=i%60;return`${g}m ${a}s`};return(p,i)=>{const g=n("List"),a=n("el-icon"),f=n("el-card"),y=n("el-col"),b=n("Check"),c=n("Close"),r=n("Timer"),u=n("el-row");return h(),x(u,{gutter:16,class:"event-stats"},{default:t(()=>[e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",fe,[o("div",ye,[e(a,{size:24},{default:t(()=>[e(g)]),_:1})]),o("div",he,[i[0]||(i[0]=o("div",{class:"stat-label"},"Total Events",-1)),o("div",ge,_(v.stats?.totalEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",be,[o("div",Se,[e(a,{size:24},{default:t(()=>[e(b)]),_:1})]),o("div",De,[i[1]||(i[1]=o("div",{class:"stat-label"},"Success",-1)),o("div",we,_(v.stats?.successEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",Ve,[o("div",Ee,[e(a,{size:24},{default:t(()=>[e(c)]),_:1})]),o("div",Te,[i[2]||(i[2]=o("div",{class:"stat-label"},"Failed",-1)),o("div",ke,_(v.stats?.failedEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",Ce,[o("div",$e,[e(a,{size:24},{default:t(()=>[e(r)]),_:1})]),o("div",xe,[i[3]||(i[3]=o("div",{class:"stat-label"},"Avg Duration",-1)),o("div",ze,_(k(v.stats?.avgDurationMs)),1)])])]),_:1})]),_:1})]),_:1})}}}),je=N(Me,[["__scopeId","data-v-dadfc410"]]),Ie=K({__name:"EventFilter",props:{modelValue:{}},emits:["update:modelValue","search"],setup(v,{emit:k}){const p=v,i=k,g=V(null),a=B({eventType:p.modelValue.eventType||"",status:p.modelValue.status||"",startDate:p.modelValue.startDate||"",endDate:p.modelValue.endDate||"",search:p.modelValue.search||""});le(a,c=>{i("update:modelValue",{...c})});const f=c=>{c&&c[0]&&c[1]?(a.startDate=c[0].toISOString().split("T")[0]||"",a.endDate=c[1].toISOString().split("T")[0]||""):(a.startDate="",a.endDate="")},y=()=>{i("search")},b=()=>{a.eventType="",a.status="",a.startDate="",a.endDate="",a.search="",g.value=null,i("search")};return(c,r)=>{const u=n("el-option"),C=n("el-select"),w=n("el-form-item"),A=n("el-date-picker"),L=n("Search"),z=n("el-icon"),M=n("el-input"),$=n("el-button"),j=n("el-form"),R=n("el-card");return h(),x(R,{class:"event-filter",shadow:"never"},{default:t(()=>[e(j,{inline:!0,model:a,class:"filter-form"},{default:t(()=>[e(w,{label:"Event Type"},{default:t(()=>[e(C,{modelValue:a.eventType,"onUpdate:modelValue":r[0]||(r[0]=S=>a.eventType=S),placeholder:"All Types",clearable:"",style:{width:"180px"}},{default:t(()=>[e(u,{label:"Incremental Sync",value:"incremental_sync"}),e(u,{label:"Full Sync",value:"full_sync"}),e(u,{label:"Manual Sync",value:"manual_sync"}),e(u,{label:"Webhook Sync",value:"webhook_sync"}),e(u,{label:"Status Change",value:"status_change"}),e(u,{label:"Discovery",value:"discovery"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"Status"},{default:t(()=>[e(C,{modelValue:a.status,"onUpdate:modelValue":r[1]||(r[1]=S=>a.status=S),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(u,{label:"Success",value:"success"}),e(u,{label:"Failed",value:"failed"}),e(u,{label:"Running",value:"running"})]),_:1},8,["modelValue"])]),_:1}),e(w,{label:"Date Range"},{default:t(()=>[e(A,{modelValue:g.value,"onUpdate:modelValue":r[2]||(r[2]=S=>g.value=S),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"280px"},onChange:f},null,8,["modelValue"])]),_:1}),e(w,{label:"Search"},{default:t(()=>[e(M,{modelValue:a.search,"onUpdate:modelValue":r[3]||(r[3]=S=>a.search=S),placeholder:"Project name",clearable:"",style:{width:"200px"},onKeyup:oe(y,["enter"])},{prefix:t(()=>[e(z,null,{default:t(()=>[e(L)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(w,null,{default:t(()=>[e($,{type:"primary",onClick:y},{default:t(()=>[...r[4]||(r[4]=[m("Search",-1)])]),_:1}),e($,{onClick:b},{default:t(()=>[...r[5]||(r[5]=[m("Reset",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ae=N(Ie,[["__scopeId","data-v-aa7a6057"]]),O={getEvents:v=>P.get("/sync/events",{params:v}),getEventStats:v=>P.get("/sync/events/stats",{params:{date:v}}),getEventDetails:v=>P.get(`/sync/events/${v}/details`)},Le={class:"sync-events"},Re={class:"project-cell"},Ue=["onClick"],Fe={class:"event-type-cell"},Pe={key:0},Oe={key:1},Be={class:"pagination"},Ke={key:0,class:"event-detail"},Ne={key:0,class:"event-details-json"},Je={key:1,class:"loading-details"},qe=K({__name:"SyncEvents",setup(v){const k=ve(),p=V(!1),i=V([]),g=V(null),a=V(null),f=V(null),y=V(!1);let b=B({eventType:"",status:"",startDate:"",endDate:"",search:""});const c=B({page:1,size:20,total:0});let r=null;const u=async()=>{p.value=!0;try{const l={...b,page:c.page,size:c.size},s=await O.getEvents(l);i.value=s.data.items,c.total=s.data.total}catch(l){q.error("Failed to load events"),console.error("Load events failed:",l)}finally{p.value=!1}},C=async()=>{try{const l=new Date().toISOString().split("T")[0],s=await O.getEventStats(l);g.value=s.data}catch(l){console.error("Load stats failed:",l)}},w=l=>{l.syncProjectId&&k.push(`/projects/${l.syncProjectId}`)},A=async l=>{a.value=l,f.value=null,y.value=!0;try{const s=await O.getEventDetails(l.id);f.value=s.data}catch(s){q.error("Failed to load event details"),console.error("Load event details failed:",s)}},L=l=>({incremental_sync:I,full_sync:I,manual_sync:I,webhook_sync:I,status_change:me,discovery:W})[l]||W,z=l=>({success:"success",running:"info",failed:"danger"})[l.toLowerCase()]||"info",M=l=>l.split("_").map(s=>s.charAt(0).toUpperCase()+s.slice(1)).join(" "),$=l=>l?new Date(l).toLocaleString():"-",j=l=>{if(!l)return"0s";if(l<1e3)return`${l}ms`;const s=Math.floor(l/1e3);if(s<60)return`${s}s`;const D=Math.floor(s/60),U=s%60;return`${D}m ${U}s`},R=()=>{r=window.setInterval(()=>{C(),u()},3e4)},S=()=>{r&&(clearInterval(r),r=null)};return de(()=>{C(),u(),R()}),ie(()=>{S()}),(l,s)=>{const D=n("el-table-column"),U=n("FolderOpened"),F=n("el-icon"),J=n("el-tag"),H=n("el-button"),Q=n("el-table"),X=n("el-pagination"),Y=n("el-card"),E=n("el-descriptions-item"),Z=n("el-descriptions"),ee=n("el-divider"),te=n("Loading"),ae=n("el-drawer"),se=_e("loading");return h(),T("div",Le,[e(je,{stats:g.value},null,8,["stats"]),e(Ae,{modelValue:re(b),"onUpdate:modelValue":s[0]||(s[0]=d=>ce(b)?b.value=d:b=d),onSearch:u},null,8,["modelValue"]),e(Y,{class:"table-card"},{default:t(()=>[ue((h(),x(Q,{data:i.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(D,{prop:"createdAt",label:"Time",width:"180"},{default:t(({row:d})=>[m(_($(d.createdAt)),1)]),_:1}),e(D,{prop:"projectKey",label:"Project","min-width":"200"},{default:t(({row:d})=>[o("div",Re,[e(F,null,{default:t(()=>[e(U)]),_:1}),o("a",{onClick:ne=>w(d),class:"project-link"},_(d.projectKey),9,Ue)])]),_:1}),e(D,{label:"Event Type",width:"160"},{default:t(({row:d})=>[o("div",Fe,[e(F,{size:16},{default:t(()=>[(h(),x(pe(L(d.eventType))))]),_:2},1024),o("span",null,_(M(d.eventType)),1)])]),_:1}),e(D,{label:"Status",width:"100"},{default:t(({row:d})=>[e(J,{type:z(d.status)},{default:t(()=>[m(_(d.status),1)]),_:2},1032,["type"])]),_:1}),e(D,{prop:"message",label:"Message","min-width":"200"}),e(D,{label:"Duration",width:"120"},{default:t(({row:d})=>[d.durationMs?(h(),T("span",Pe,_(j(d.durationMs)),1)):(h(),T("span",Oe,"-"))]),_:1}),e(D,{label:"Actions",width:"120",fixed:"right"},{default:t(({row:d})=>[e(H,{size:"small",onClick:ne=>A(d)},{default:t(()=>[...s[4]||(s[4]=[m(" Detail ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,p.value]]),o("div",Be,[e(X,{"current-page":c.page,"onUpdate:currentPage":s[1]||(s[1]=d=>c.page=d),"page-size":c.size,"onUpdate:pageSize":s[2]||(s[2]=d=>c.size=d),total:c.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1}),e(ae,{modelValue:y.value,"onUpdate:modelValue":s[3]||(s[3]=d=>y.value=d),title:"Event Detail",size:"50%",direction:"rtl"},{default:t(()=>[a.value?(h(),T("div",Ke,[e(Z,{column:1,border:""},{default:t(()=>[e(E,{label:"Event ID"},{default:t(()=>[m(_(a.value.id),1)]),_:1}),e(E,{label:"Project"},{default:t(()=>[m(_(a.value.projectKey),1)]),_:1}),e(E,{label:"Event Type"},{default:t(()=>[m(_(M(a.value.eventType)),1)]),_:1}),e(E,{label:"Status"},{default:t(()=>[e(J,{type:z(a.value.status)},{default:t(()=>[m(_(a.value.status),1)]),_:1},8,["type"])]),_:1}),e(E,{label:"Time"},{default:t(()=>[m(_($(a.value.createdAt)),1)]),_:1}),a.value.durationMs?(h(),x(E,{key:0,label:"Duration"},{default:t(()=>[m(_(j(a.value.durationMs)),1)]),_:1})):G("",!0)]),_:1}),e(ee),s[6]||(s[6]=o("h3",null,"Event Details",-1)),f.value?(h(),T("div",Ne,[o("pre",null,_(JSON.stringify(f.value,null,2)),1)])):(h(),T("div",Je,[e(F,{class:"is-loading"},{default:t(()=>[e(te)]),_:1}),s[5]||(s[5]=m(" Loading details... ",-1))]))])):G("",!0)]),_:1},8,["modelValue"])])}}}),He=N(qe,[["__scopeId","data-v-1d4ff6ae"]]);export{He as default};
