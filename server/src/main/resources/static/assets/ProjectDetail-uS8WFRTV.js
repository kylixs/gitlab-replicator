import{d as k,k as T,b as e,r as l,w as t,a,j as i,t as o,o as b,_ as B,f as C,z as H,h as U,G as J,H as Q,c as $,e as X,E as A,I as O,q as Y,J as M,B as Z,i as ee,l as R,D as V,y as te}from"./index-TlEndt19.js";import{e as ae}from"./events-BvMTPhp8.js";import{p as K}from"./projects-Xszmq6dW.js";import"./client-C0jSVIxo.js";const se={class:"overview-tab"},oe={class:"stat-item"},ne={class:"stat-icon success"},le={class:"stat-info"},ie={class:"stat-item"},de={class:"stat-icon warning"},ce={class:"stat-info"},re={class:"stat-value"},ue={class:"stat-item"},fe={class:"stat-icon info"},ve={class:"stat-info"},_e={class:"stat-value"},me={class:"stat-item"},pe={class:"stat-icon primary"},ye={class:"stat-info"},he={class:"stat-value"},ge={class:"diff-item"},we={class:"diff-value new"},be={class:"diff-item"},je={class:"diff-value deleted"},Se={class:"diff-item"},Ce={class:"diff-value outdated"},Te={class:"diff-item"},xe={class:"diff-value new"},ze={class:"card-header"},Ae={class:"card-header"},De=k({__name:"OverviewTab",props:{overview:{}},setup(n){const S=m=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[m.toLowerCase()]||"info",f=m=>m?new Date(m).toLocaleString():"-";return(m,s)=>{const j=l("Check"),h=l("el-icon"),w=l("el-tag"),u=l("el-card"),v=l("el-col"),x=l("Timer"),d=l("Clock"),r=l("Calendar"),g=l("el-row"),c=l("el-descriptions-item"),p=l("el-descriptions");return b(),T("div",se,[e(g,{gutter:16,class:"status-cards"},{default:t(()=>[e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover"},{default:t(()=>[a("div",oe,[a("div",ne,[e(h,{size:24},{default:t(()=>[e(j)]),_:1})]),a("div",le,[s[0]||(s[0]=a("div",{class:"stat-label"},"Status",-1)),e(w,{type:S(n.overview.project.syncStatus)},{default:t(()=>[i(o(n.overview.project.syncStatus),1)]),_:1},8,["type"])])])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover"},{default:t(()=>[a("div",ie,[a("div",de,[e(h,{size:24},{default:t(()=>[e(x)]),_:1})]),a("div",ce,[s[1]||(s[1]=a("div",{class:"stat-label"},"Delay",-1)),a("div",re,o(n.overview.delay?.formatted||"-"),1)])])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover"},{default:t(()=>[a("div",ue,[a("div",fe,[e(h,{size:24},{default:t(()=>[e(d)]),_:1})]),a("div",ve,[s[2]||(s[2]=a("div",{class:"stat-label"},"Last Sync",-1)),a("div",_e,o(f(n.overview.project.lastSyncAt)),1)])])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover"},{default:t(()=>[a("div",me,[a("div",pe,[e(h,{size:24},{default:t(()=>[e(r)]),_:1})]),a("div",ye,[s[3]||(s[3]=a("div",{class:"stat-label"},"Next Sync",-1)),a("div",he,o(f(n.overview.nextSyncTime)),1)])])]),_:1})]),_:1})]),_:1}),e(g,{gutter:16,class:"diff-stats"},{default:t(()=>[e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",ge,[s[4]||(s[4]=a("div",{class:"diff-label"},"New Branches",-1)),a("div",we,"+"+o(n.overview.diff?.branchNew||0),1)])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",be,[s[5]||(s[5]=a("div",{class:"diff-label"},"Deleted Branches",-1)),a("div",je,"-"+o(n.overview.diff?.branchDeleted||0),1)])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",Se,[s[6]||(s[6]=a("div",{class:"diff-label"},"Outdated Branches",-1)),a("div",Ce,"~"+o(n.overview.diff?.branchOutdated||0),1)])]),_:1})]),_:1}),e(v,{xs:24,sm:12,md:6},{default:t(()=>[e(u,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",Te,[s[7]||(s[7]=a("div",{class:"diff-label"},"Commit Diff",-1)),a("div",xe,"+"+o(n.overview.diff?.commitDiff||0),1)])]),_:1})]),_:1})]),_:1}),e(g,{gutter:16,class:"project-info-row"},{default:t(()=>[e(v,{xs:24,md:12},{default:t(()=>[e(u,{shadow:"hover"},{header:t(()=>[a("div",ze,[s[9]||(s[9]=a("span",null,"Source Project",-1)),e(w,{type:"info",size:"small"},{default:t(()=>[...s[8]||(s[8]=[i("GitLab",-1)])]),_:1})])]),default:t(()=>[e(p,{column:1,border:""},{default:t(()=>[e(c,{label:"Project ID"},{default:t(()=>[i(o(n.overview.source?.id),1)]),_:1}),e(c,{label:"Name"},{default:t(()=>[i(o(n.overview.source?.name),1)]),_:1}),e(c,{label:"Path"},{default:t(()=>[i(o(n.overview.source?.pathWithNamespace),1)]),_:1}),e(c,{label:"Default Branch"},{default:t(()=>[i(o(n.overview.source?.defaultBranch),1)]),_:1}),e(c,{label:"Last Activity"},{default:t(()=>[i(o(f(n.overview.source?.lastActivityAt)),1)]),_:1}),e(c,{label:"Commit Count"},{default:t(()=>[i(o(n.overview.source?.commitCount||"-"),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(v,{xs:24,md:12},{default:t(()=>[e(u,{shadow:"hover"},{header:t(()=>[a("div",Ae,[s[11]||(s[11]=a("span",null,"Target Project",-1)),e(w,{type:"success",size:"small"},{default:t(()=>[...s[10]||(s[10]=[i("GitLab",-1)])]),_:1})])]),default:t(()=>[e(p,{column:1,border:""},{default:t(()=>[e(c,{label:"Project ID"},{default:t(()=>[i(o(n.overview.target?.id),1)]),_:1}),e(c,{label:"Name"},{default:t(()=>[i(o(n.overview.target?.name),1)]),_:1}),e(c,{label:"Path"},{default:t(()=>[i(o(n.overview.target?.pathWithNamespace),1)]),_:1}),e(c,{label:"Default Branch"},{default:t(()=>[i(o(n.overview.target?.defaultBranch),1)]),_:1}),e(c,{label:"Last Activity"},{default:t(()=>[i(o(f(n.overview.target?.lastActivityAt)),1)]),_:1}),e(c,{label:"Commit Count"},{default:t(()=>[i(o(n.overview.target?.commitCount||"-"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(u,{shadow:"hover",class:"sync-config"},{header:t(()=>[...s[12]||(s[12]=[a("span",null,"Sync Configuration",-1)])]),default:t(()=>[e(p,{column:2,border:""},{default:t(()=>[e(c,{label:"Sync Method"},{default:t(()=>[e(w,{type:"info"},{default:t(()=>[i(o(n.overview.project.syncMethod==="push_mirror"?"Push Mirror":"Pull Sync"),1)]),_:1})]),_:1}),e(c,{label:"Created At"},{default:t(()=>[i(o(f(n.overview.project.createdAt)),1)]),_:1}),e(c,{label:"Updated At"},{default:t(()=>[i(o(f(n.overview.project.updatedAt)),1)]),_:1}),e(c,{label:"Last Sync At"},{default:t(()=>[i(o(f(n.overview.project.lastSyncAt)),1)]),_:1})]),_:1})]),_:1})])}}}),Me=B(De,[["__scopeId","data-v-70d3a06d"]]),$e={class:"branches-tab"},ke=k({__name:"BranchesTab",props:{projectId:{}},setup(n){return(S,f)=>{const m=l("el-empty");return b(),T("div",$e,[e(m,{description:"Branches comparison feature coming soon..."})])}}}),Be=B(ke,[["__scopeId","data-v-9b651a1f"]]),Le={class:"events-tab"},Ie={class:"event-type-cell"},Ne={key:0},Pe={key:1},Ee={class:"pagination"},Oe=k({__name:"EventsTab",props:{projectId:{},projectKey:{}},setup(n){const S=n,f=C(!1),m=C([]),s=H({page:1,size:20,total:0}),j=async()=>{f.value=!0;try{const d=await ae.getEvents({search:S.projectKey,page:s.page,size:s.size});m.value=d.data.items.filter(r=>r.projectKey===S.projectKey),s.total=m.value.length}catch(d){A.error("Failed to load events"),console.error("Load events failed:",d)}finally{f.value=!1}},h=d=>({incremental_sync:M,full_sync:M,manual_sync:M,webhook_sync:M,status_change:Y,discovery:O})[d]||O,w=d=>({success:"success",running:"info",failed:"danger"})[d.toLowerCase()]||"info",u=d=>d.split("_").map(r=>r.charAt(0).toUpperCase()+r.slice(1)).join(" "),v=d=>d?new Date(d).toLocaleString():"-",x=d=>{if(!d)return"0s";if(d<1e3)return`${d}ms`;const r=Math.floor(d/1e3);if(r<60)return`${r}s`;const g=Math.floor(r/60),c=r%60;return`${g}m ${c}s`};return U(()=>{j()}),(d,r)=>{const g=l("el-table-column"),c=l("el-icon"),p=l("el-tag"),y=l("el-table"),z=l("el-pagination"),L=Q("loading");return b(),T("div",Le,[J((b(),$(y,{data:m.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(g,{prop:"createdAt",label:"Time",width:"180"},{default:t(({row:_})=>[i(o(v(_.createdAt)),1)]),_:1}),e(g,{label:"Event Type",width:"160"},{default:t(({row:_})=>[a("div",Ie,[e(c,{size:16},{default:t(()=>[(b(),$(X(h(_.eventType))))]),_:2},1024),a("span",null,o(u(_.eventType)),1)])]),_:1}),e(g,{label:"Status",width:"100"},{default:t(({row:_})=>[e(p,{type:w(_.status)},{default:t(()=>[i(o(_.status),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"message",label:"Message","min-width":"200"}),e(g,{label:"Duration",width:"120"},{default:t(({row:_})=>[_.durationMs?(b(),T("span",Ne,o(x(_.durationMs)),1)):(b(),T("span",Pe,"-"))]),_:1})]),_:1},8,["data"])),[[L,f.value]]),a("div",Ee,[e(z,{"current-page":s.page,"onUpdate:currentPage":r[0]||(r[0]=_=>s.page=_),"page-size":s.size,"onUpdate:pageSize":r[1]||(r[1]=_=>s.size=_),total:s.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:j,onCurrentChange:j},null,8,["current-page","page-size","total"])])])}}}),Re=B(Oe,[["__scopeId","data-v-3c6bfe63"]]),Ve={class:"project-detail"},Ke={class:"header-content"},Ue={class:"project-info"},Fe={class:"action-buttons"},Ge={key:0,class:"loading-container"},We=k({__name:"ProjectDetail",setup(n){const S=Z(),f=Number(S.params.id),m=C(!1),s=C(!1),j=C("overview"),h=C(null),w=C("");let u=null;const v=async()=>{m.value=!0;try{const p=await K.getProjectOverview(f);h.value=p.data,w.value=p.data.project.projectKey}catch(p){A.error("Failed to load project overview"),console.error("Load overview failed:",p)}finally{m.value=!1}},x=async()=>{try{await te.confirm(`Are you sure to sync project "${w.value}"?`,"Confirm Sync",{type:"warning"}),s.value=!0,await K.batchSync([f]),A.success("Sync triggered successfully"),setTimeout(()=>v(),2e3)}catch(p){p!=="cancel"&&A.error("Failed to trigger sync")}finally{s.value=!1}},d=()=>{v(),A.success("Refreshed")},r=p=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[p.toLowerCase()]||"info",g=()=>{u=window.setInterval(()=>{v()},3e4)},c=()=>{u&&(clearInterval(u),u=null)};return U(()=>{v(),g()}),ee(()=>{c()}),(p,y)=>{const z=l("el-breadcrumb-item"),L=l("el-breadcrumb"),_=l("FolderOpened"),D=l("el-icon"),F=l("el-tag"),N=l("Refresh"),P=l("el-button"),E=l("el-card"),G=l("Loading"),I=l("el-tab-pane"),W=l("el-tabs");return b(),T("div",Ve,[e(L,{class:"breadcrumb",separator:"/"},{default:t(()=>[e(z,{to:{path:"/"}},{default:t(()=>[...y[1]||(y[1]=[i("Dashboard",-1)])]),_:1}),e(z,{to:{path:"/projects"}},{default:t(()=>[...y[2]||(y[2]=[i("Projects",-1)])]),_:1}),e(z,null,{default:t(()=>[i(o(w.value),1)]),_:1})]),_:1}),e(E,{class:"header-card",shadow:"never"},{default:t(()=>[a("div",Ke,[a("div",Ue,[e(D,{size:32},{default:t(()=>[e(_)]),_:1}),a("div",null,[a("h2",null,o(w.value),1),h.value?(b(),$(F,{key:0,type:r(h.value.project.syncStatus)},{default:t(()=>[i(o(h.value.project.syncStatus),1)]),_:1},8,["type"])):R("",!0)])]),a("div",Fe,[e(P,{loading:s.value,onClick:x},{default:t(()=>[e(D,null,{default:t(()=>[e(N)]),_:1}),y[3]||(y[3]=i(" Sync Now ",-1))]),_:1},8,["loading"]),e(P,{onClick:d},{default:t(()=>[e(D,null,{default:t(()=>[e(N)]),_:1}),y[4]||(y[4]=i(" Refresh ",-1))]),_:1})])])]),_:1}),m.value?(b(),T("div",Ge,[e(D,{class:"is-loading",size:48},{default:t(()=>[e(G)]),_:1}),y[5]||(y[5]=a("p",null,"Loading project details...",-1))])):h.value?(b(),$(E,{key:1,class:"tabs-card"},{default:t(()=>[e(W,{modelValue:j.value,"onUpdate:modelValue":y[0]||(y[0]=q=>j.value=q)},{default:t(()=>[e(I,{label:"Overview",name:"overview"},{default:t(()=>[e(Me,{overview:h.value},null,8,["overview"])]),_:1}),e(I,{label:"Branches",name:"branches"},{default:t(()=>[e(Be,{"project-id":V(f)},null,8,["project-id"])]),_:1}),e(I,{label:"Sync Events",name:"events"},{default:t(()=>[e(Re,{"project-id":V(f),"project-key":w.value},null,8,["project-id","project-key"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):R("",!0)])}}}),Xe=B(We,[["__scopeId","data-v-d62a7fc0"]]);export{Xe as default};
