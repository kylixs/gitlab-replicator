import{d as Q,z as J,g as ce,c as U,w as t,r,b as e,k as D,p as de,F as ue,A as ie,j as p,o as _,_ as W,m as pe,a as S,l as z,t as b,f as $,B as fe,h as ye,C as me,D as he,E as h,G as _e,H as ge,x as be,y as F}from"./index-DC9Hbw5F.js";import{c as B}from"./client-C0jSVIxo.js";const ve=Q({__name:"FilterBar",props:{groups:{},modelValue:{}},emits:["update:modelValue","search","export"],setup(n,{emit:k}){const v=n,w=k,s=J({group:v.modelValue.group||"",status:v.modelValue.status||"",syncMethod:v.modelValue.syncMethod||"",delayRange:v.modelValue.delayRange||"",search:v.modelValue.search||""});ce(s,g=>{w("update:modelValue",{...g})});const A=()=>{w("search")},f=()=>{s.group="",s.status="",s.syncMethod="",s.delayRange="",s.search="",w("search")},P=()=>{w("export")};return(g,c)=>{const d=r("el-option"),u=r("el-select"),j=r("el-form-item"),E=r("Search"),V=r("el-icon"),L=r("el-input"),R=r("el-button"),N=r("Download"),G=r("el-form"),K=r("el-card");return _(),U(K,{class:"filter-bar",shadow:"never"},{default:t(()=>[e(G,{inline:!0,model:s,class:"filter-form"},{default:t(()=>[e(j,{label:"Group"},{default:t(()=>[e(u,{modelValue:s.group,"onUpdate:modelValue":c[0]||(c[0]=i=>s.group=i),placeholder:"All Groups",clearable:"",style:{width:"180px"}},{default:t(()=>[(_(!0),D(ue,null,de(n.groups,i=>(_(),U(d,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(j,{label:"Status"},{default:t(()=>[e(u,{modelValue:s.status,"onUpdate:modelValue":c[1]||(c[1]=i=>s.status=i),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"Synced",value:"synced"}),e(d,{label:"Syncing",value:"syncing"}),e(d,{label:"Outdated",value:"outdated"}),e(d,{label:"Paused",value:"paused"}),e(d,{label:"Failed",value:"failed"}),e(d,{label:"Pending",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),e(j,{label:"Sync Method"},{default:t(()=>[e(u,{modelValue:s.syncMethod,"onUpdate:modelValue":c[2]||(c[2]=i=>s.syncMethod=i),placeholder:"All Methods",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"Push Mirror",value:"push_mirror"}),e(d,{label:"Pull Sync",value:"pull_sync"})]),_:1},8,["modelValue"])]),_:1}),e(j,{label:"Delay Range"},{default:t(()=>[e(u,{modelValue:s.delayRange,"onUpdate:modelValue":c[3]||(c[3]=i=>s.delayRange=i),placeholder:"All Delays",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"< 1 hour",value:"0-3600"}),e(d,{label:"1-24 hours",value:"3600-86400"}),e(d,{label:"1-7 days",value:"86400-604800"}),e(d,{label:"> 7 days",value:"604800-"})]),_:1},8,["modelValue"])]),_:1}),e(j,{label:"Search"},{default:t(()=>[e(L,{modelValue:s.search,"onUpdate:modelValue":c[4]||(c[4]=i=>s.search=i),placeholder:"Project name or path",clearable:"",style:{width:"200px"},onKeyup:ie(A,["enter"])},{prefix:t(()=>[e(V,null,{default:t(()=>[e(E)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(j,null,{default:t(()=>[e(R,{type:"primary",onClick:A},{default:t(()=>[...c[5]||(c[5]=[p("Search",-1)])]),_:1}),e(R,{onClick:f},{default:t(()=>[...c[6]||(c[6]=[p("Reset",-1)])]),_:1}),e(R,{onClick:P},{default:t(()=>[e(V,null,{default:t(()=>[e(N)]),_:1}),c[7]||(c[7]=p(" Export CSV ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Se=W(ve,[["__scopeId","data-v-1375c9f6"]]),we={class:"diff-badge"},Ce={class:"diff-item"},je={key:0,class:"diff-value new"},Ve={key:1,class:"diff-value deleted"},De={key:2,class:"diff-value outdated"},ke={key:3,class:"diff-value synced"},Pe={key:0,class:"diff-item"},xe={class:"diff-value new"},Be=Q({__name:"DiffBadge",props:{diff:{}},setup(n){const k=n,v=pe(()=>k.diff.branchNew>0||k.diff.branchDeleted>0||k.diff.branchOutdated>0);return(w,s)=>(_(),D("div",we,[S("div",Ce,[s[0]||(s[0]=S("span",{class:"diff-label"},"Branches:",-1)),n.diff.branchNew>0?(_(),D("span",je,"+"+b(n.diff.branchNew),1)):z("",!0),n.diff.branchDeleted>0?(_(),D("span",Ve,"-"+b(n.diff.branchDeleted),1)):z("",!0),n.diff.branchOutdated>0?(_(),D("span",De,"~"+b(n.diff.branchOutdated),1)):z("",!0),v.value?z("",!0):(_(),D("span",ke,"Synced"))]),n.diff.commitDiff>0?(_(),D("div",Pe,[s[1]||(s[1]=S("span",{class:"diff-label"},"Commits:",-1)),S("span",xe,"+"+b(n.diff.commitDiff),1)])):z("",!0)]))}}),Me=W(Be,[["__scopeId","data-v-40f6b2ec"]]),M={getProjects:n=>B.get("/sync/projects",{params:n}),getGroups:()=>B.get("/sync/projects/groups"),getProjectOverview:n=>B.get(`/sync/projects/${n}/overview`),batchSync:n=>B.post("/sync/projects/batch-sync",{projectIds:n}),batchPause:n=>B.post("/sync/projects/batch-pause",{projectIds:n}),batchResume:n=>B.post("/sync/projects/batch-resume",{projectIds:n}),batchDelete:n=>B.post("/sync/projects/batch-delete",{projectIds:n})},Re={class:"projects"},$e={class:"batch-content"},ze={class:"batch-info"},Ae={class:"batch-actions"},Fe={class:"project-cell"},Oe=["onClick"],Ue={class:"pagination"},Ee=Q({__name:"Projects",setup(n){const k=be(),v=fe(),w=$(!1),s=$([]),A=$([]),f=$([]);let P=J({group:v.query.group||"",status:v.query.status||"",syncMethod:"",delayRange:"",search:""});const g=J({page:1,size:20,total:0}),c=$(""),d=$("asc"),u=async()=>{w.value=!0;try{const a={...P,page:g.page,size:g.size,sortBy:c.value,sortOrder:d.value},l=await M.getProjects(a);s.value=l.data.items,g.total=l.data.total}catch(a){h.error("Failed to load projects"),console.error("Load projects failed:",a)}finally{w.value=!1}},j=async()=>{try{const a=await M.getGroups();A.value=a.data}catch(a){console.error("Load groups failed:",a)}},E=a=>{f.value=a.map(l=>l.id)},V=()=>{f.value=[]},L=({prop:a,order:l})=>{l?(c.value=a,d.value=l==="ascending"?"asc":"desc"):(c.value="",d.value="asc"),u()},R=a=>{k.push(`/projects/${a.id}`)},N=async a=>{try{await F.confirm(`Are you sure to sync project "${a.projectKey}"?`,"Confirm Sync",{type:"warning"}),await M.batchSync([a.id]),h.success("Sync triggered successfully"),u()}catch(l){l!=="cancel"&&h.error("Failed to trigger sync")}},G=async()=>{try{await F.confirm(`Are you sure to sync ${f.value.length} projects?`,"Confirm Batch Sync",{type:"warning"}),await M.batchSync(f.value),h.success("Batch sync triggered successfully"),V(),u()}catch(a){a!=="cancel"&&h.error("Failed to trigger batch sync")}},K=async()=>{try{await F.confirm(`Are you sure to pause ${f.value.length} projects?`,"Confirm Batch Pause",{type:"warning"}),await M.batchPause(f.value),h.success("Projects paused successfully"),V(),u()}catch(a){a!=="cancel"&&h.error("Failed to pause projects")}},i=async()=>{try{await F.confirm(`Are you sure to resume ${f.value.length} projects?`,"Confirm Batch Resume",{type:"info"}),await M.batchResume(f.value),h.success("Projects resumed successfully"),V(),u()}catch(a){a!=="cancel"&&h.error("Failed to resume projects")}},ee=async()=>{try{await F.confirm(`Are you sure to delete ${f.value.length} projects? This action cannot be undone!`,"Confirm Batch Delete",{type:"error"}),await M.batchDelete(f.value),h.success("Projects deleted successfully"),V(),u()}catch(a){a!=="cancel"&&h.error("Failed to delete projects")}},te=a=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[a.toLowerCase()]||"info",ae=a=>a<3600?"success":a<86400?"warning":"danger",X=a=>a==="push_mirror"?"Push Mirror":"Pull Sync",O=a=>a?new Date(a).toLocaleString():"-",le=()=>{try{const a=["Project","Status","Branch New","Branch Deleted","Branch Outdated","Commit Diff","Delay","Sync Method","Last Sync","Updated"],l=s.value.map(m=>[m.projectKey,m.syncStatus,m.diff.branchNew.toString(),m.diff.branchDeleted.toString(),m.diff.branchOutdated.toString(),m.diff.commitDiff.toString(),m.delayFormatted,X(m.syncMethod),O(m.lastSyncAt),O(m.updatedAt)]),T=[a.join(","),...l.map(m=>m.map(q=>`"${q}"`).join(","))].join(`
`),x=new Blob([T],{type:"text/csv;charset=utf-8;"}),y=document.createElement("a"),I=URL.createObjectURL(x);y.setAttribute("href",I),y.setAttribute("download",`projects_${new Date().toISOString().split("T")[0]}.csv`),y.style.visibility="hidden",document.body.appendChild(y),y.click(),document.body.removeChild(y),h.success(`Exported ${s.value.length} projects`)}catch(a){h.error("Failed to export projects"),console.error("Export failed:",a)}};return ye(()=>{j(),u()}),(a,l)=>{const T=r("Refresh"),x=r("el-icon"),y=r("el-button"),I=r("VideoPause"),m=r("VideoPlay"),q=r("Delete"),Y=r("el-card"),C=r("el-table-column"),se=r("FolderOpened"),H=r("el-tag"),oe=r("el-table"),ne=r("el-pagination"),re=ge("loading");return _(),D("div",Re,[e(Se,{modelValue:he(P),"onUpdate:modelValue":l[0]||(l[0]=o=>me(P)?P.value=o:P=o),groups:A.value,onSearch:u,onExport:le},null,8,["modelValue","groups"]),f.value.length>0?(_(),U(Y,{key:0,class:"batch-bar",shadow:"never"},{default:t(()=>[S("div",$e,[S("span",ze,b(f.value.length)+" projects selected",1),S("div",Ae,[e(y,{size:"small",onClick:G},{default:t(()=>[e(x,null,{default:t(()=>[e(T)]),_:1}),l[3]||(l[3]=p(" Sync ",-1))]),_:1}),e(y,{size:"small",onClick:K},{default:t(()=>[e(x,null,{default:t(()=>[e(I)]),_:1}),l[4]||(l[4]=p(" Pause ",-1))]),_:1}),e(y,{size:"small",onClick:i},{default:t(()=>[e(x,null,{default:t(()=>[e(m)]),_:1}),l[5]||(l[5]=p(" Resume ",-1))]),_:1}),e(y,{size:"small",type:"danger",onClick:ee},{default:t(()=>[e(x,null,{default:t(()=>[e(q)]),_:1}),l[6]||(l[6]=p(" Delete ",-1))]),_:1}),e(y,{size:"small",onClick:V},{default:t(()=>[...l[7]||(l[7]=[p("Clear",-1)])]),_:1})])])]),_:1})):z("",!0),e(Y,{class:"table-card"},{default:t(()=>[_e((_(),U(oe,{data:s.value,stripe:"",style:{width:"100%"},onSelectionChange:E,onSortChange:L},{default:t(()=>[e(C,{type:"selection",width:"55"}),e(C,{prop:"projectKey",label:"Project","min-width":"250",sortable:"custom"},{default:t(({row:o})=>[S("div",Fe,[e(x,null,{default:t(()=>[e(se)]),_:1}),S("a",{onClick:Z=>R(o),class:"project-link"},b(o.projectKey),9,Oe)])]),_:1}),e(C,{label:"Status",width:"120"},{default:t(({row:o})=>[e(H,{type:te(o.syncStatus)},{default:t(()=>[p(b(o.syncStatus),1)]),_:2},1032,["type"])]),_:1}),e(C,{label:"Diff",width:"200"},{default:t(({row:o})=>[e(Me,{diff:o.diff},null,8,["diff"])]),_:1}),e(C,{label:"Delay",width:"120",sortable:"custom",prop:"delaySeconds"},{default:t(({row:o})=>[e(H,{type:ae(o.delaySeconds)},{default:t(()=>[p(b(o.delayFormatted),1)]),_:2},1032,["type"])]),_:1}),e(C,{prop:"syncMethod",label:"Sync Method",width:"130"},{default:t(({row:o})=>[e(H,{type:"info",size:"small"},{default:t(()=>[p(b(X(o.syncMethod)),1)]),_:2},1024)]),_:1}),e(C,{prop:"lastSyncAt",label:"Last Sync",width:"180",sortable:"custom"},{default:t(({row:o})=>[p(b(O(o.lastSyncAt)),1)]),_:1}),e(C,{prop:"updatedAt",label:"Updated",width:"180",sortable:"custom"},{default:t(({row:o})=>[p(b(O(o.updatedAt)),1)]),_:1}),e(C,{label:"Actions",width:"200",fixed:"right"},{default:t(({row:o})=>[e(y,{size:"small",onClick:Z=>R(o)},{default:t(()=>[...l[8]||(l[8]=[p("Detail",-1)])]),_:1},8,["onClick"]),e(y,{size:"small",type:"primary",onClick:Z=>N(o)},{default:t(()=>[...l[9]||(l[9]=[p("Sync",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[re,w.value]]),S("div",Ue,[e(ne,{"current-page":g.page,"onUpdate:currentPage":l[1]||(l[1]=o=>g.page=o),"page-size":g.size,"onUpdate:pageSize":l[2]||(l[2]=o=>g.size=o),total:g.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Ge=W(Ee,[["__scopeId","data-v-e006e351"]]);export{Ge as default};
