import{d as H,c as A,w as t,r as l,b as e,a as o,t as r,o as S,_ as W,f as x,z as G,g as oe,A as ce,j as v,h as de,i as ie,k as $,C as re,D as ue,E as U,G as _e,H as pe,e as ve,l as Q,x as me,I as X,q as fe,J as F}from"./index-C07AZsbA.js";import{c as J}from"./client-C0jSVIxo.js";const ye={class:"stat-item"},he={class:"stat-icon primary"},ge={class:"stat-info"},be={class:"stat-value"},Se={class:"stat-item"},we={class:"stat-icon success"},De={class:"stat-info"},Ee={class:"stat-value"},Ve={class:"stat-item"},Te={class:"stat-icon danger"},xe={class:"stat-info"},Ce={class:"stat-value"},ke={class:"stat-item"},$e={class:"stat-icon info"},je={class:"stat-info"},Me={class:"stat-value"},ze=H({__name:"EventStats",props:{stats:{}},setup(p){const j=u=>{if(!u)return"0s";if(u<1e3)return`${u}ms`;const d=Math.floor(u/1e3);if(d<60)return`${d}s`;const w=Math.floor(d/60),a=d%60;return`${w}m ${a}s`};return(u,d)=>{const w=l("List"),a=l("el-icon"),y=l("el-card"),h=l("el-col"),E=l("Check"),m=l("Close"),_=l("Timer"),i=l("el-row");return S(),A(i,{gutter:16,class:"event-stats"},{default:t(()=>[e(h,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{shadow:"hover"},{default:t(()=>[o("div",ye,[o("div",he,[e(a,{size:24},{default:t(()=>[e(w)]),_:1})]),o("div",ge,[d[0]||(d[0]=o("div",{class:"stat-label"},"Total Events",-1)),o("div",be,r(p.stats?.totalEvents||0),1)])])]),_:1})]),_:1}),e(h,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{shadow:"hover"},{default:t(()=>[o("div",Se,[o("div",we,[e(a,{size:24},{default:t(()=>[e(E)]),_:1})]),o("div",De,[d[1]||(d[1]=o("div",{class:"stat-label"},"Success",-1)),o("div",Ee,r(p.stats?.successEvents||0),1)])])]),_:1})]),_:1}),e(h,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{shadow:"hover"},{default:t(()=>[o("div",Ve,[o("div",Te,[e(a,{size:24},{default:t(()=>[e(m)]),_:1})]),o("div",xe,[d[2]||(d[2]=o("div",{class:"stat-label"},"Failed",-1)),o("div",Ce,r(p.stats?.failedEvents||0),1)])])]),_:1})]),_:1}),e(h,{xs:24,sm:12,md:6},{default:t(()=>[e(y,{shadow:"hover"},{default:t(()=>[o("div",ke,[o("div",$e,[e(a,{size:24},{default:t(()=>[e(_)]),_:1})]),o("div",je,[d[3]||(d[3]=o("div",{class:"stat-label"},"Avg Duration",-1)),o("div",Me,r(j(p.stats?.avgDurationMs)),1)])])]),_:1})]),_:1})]),_:1})}}}),Ae=W(ze,[["__scopeId","data-v-dadfc410"]]),Ie=H({__name:"EventFilter",props:{modelValue:{}},emits:["update:modelValue","search","export"],setup(p,{emit:j}){const u=p,d=j,w=x(null),a=G({eventType:u.modelValue.eventType||"",status:u.modelValue.status||"",startDate:u.modelValue.startDate||"",endDate:u.modelValue.endDate||"",search:u.modelValue.search||""});oe(a,_=>{d("update:modelValue",{..._})});const y=_=>{_&&_[0]&&_[1]?(a.startDate=_[0].toISOString().split("T")[0]||"",a.endDate=_[1].toISOString().split("T")[0]||""):(a.startDate="",a.endDate="")},h=()=>{d("search")},E=()=>{a.eventType="",a.status="",a.startDate="",a.endDate="",a.search="",w.value=null,d("search")},m=()=>{d("export")};return(_,i)=>{const f=l("el-option"),I=l("el-select"),V=l("el-form-item"),O=l("el-date-picker"),L=l("Search"),C=l("el-icon"),M=l("el-input"),T=l("el-button"),P=l("Download"),K=l("el-form"),B=l("el-card");return S(),A(B,{class:"event-filter",shadow:"never"},{default:t(()=>[e(K,{inline:!0,model:a,class:"filter-form"},{default:t(()=>[e(V,{label:"Event Type"},{default:t(()=>[e(I,{modelValue:a.eventType,"onUpdate:modelValue":i[0]||(i[0]=s=>a.eventType=s),placeholder:"All Types",clearable:"",style:{width:"180px"}},{default:t(()=>[e(f,{label:"Incremental Sync",value:"incremental_sync"}),e(f,{label:"Full Sync",value:"full_sync"}),e(f,{label:"Manual Sync",value:"manual_sync"}),e(f,{label:"Webhook Sync",value:"webhook_sync"}),e(f,{label:"Status Change",value:"status_change"}),e(f,{label:"Discovery",value:"discovery"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Status"},{default:t(()=>[e(I,{modelValue:a.status,"onUpdate:modelValue":i[1]||(i[1]=s=>a.status=s),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(f,{label:"Success",value:"success"}),e(f,{label:"Failed",value:"failed"}),e(f,{label:"Running",value:"running"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Date Range"},{default:t(()=>[e(O,{modelValue:w.value,"onUpdate:modelValue":i[2]||(i[2]=s=>w.value=s),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"280px"},onChange:y},null,8,["modelValue"])]),_:1}),e(V,{label:"Search"},{default:t(()=>[e(M,{modelValue:a.search,"onUpdate:modelValue":i[3]||(i[3]=s=>a.search=s),placeholder:"Project name",clearable:"",style:{width:"200px"},onKeyup:ce(h,["enter"])},{prefix:t(()=>[e(C,null,{default:t(()=>[e(L)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(T,{type:"primary",onClick:h},{default:t(()=>[...i[4]||(i[4]=[v("Search",-1)])]),_:1}),e(T,{onClick:E},{default:t(()=>[...i[5]||(i[5]=[v("Reset",-1)])]),_:1}),e(T,{onClick:m},{default:t(()=>[e(C,null,{default:t(()=>[e(P)]),_:1}),i[6]||(i[6]=v(" Export CSV ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Le=W(Ie,[["__scopeId","data-v-e0fc3d63"]]),q={getEvents:p=>J.get("/sync/events",{params:p}),getEventStats:p=>J.get("/sync/events/stats",{params:{date:p}}),getEventDetails:p=>J.get(`/sync/events/${p}/details`)},Re={class:"sync-events"},Ue={class:"project-cell"},Fe=["onClick"],Oe={class:"event-type-cell"},Pe={key:0},Ke={key:1},Be={class:"pagination"},Ne={key:0,class:"event-detail"},Je={key:0,class:"event-details-json"},qe={key:1,class:"loading-details"},Ge=H({__name:"SyncEvents",setup(p){const j=me(),u=x(!1),d=x([]),w=x(null),a=x(null),y=x(null),h=x(!1);let E=G({eventType:"",status:"",startDate:"",endDate:"",search:""});const m=G({page:1,size:20,total:0});let _=null;const i=async()=>{u.value=!0;try{const s={...E,page:m.page,size:m.size},n=await q.getEvents(s);d.value=n.data.items,m.total=n.data.total}catch(s){U.error("Failed to load events"),console.error("Load events failed:",s)}finally{u.value=!1}},f=async()=>{try{const s=new Date().toISOString().split("T")[0],n=await q.getEventStats(s);w.value=n.data}catch(s){console.error("Load stats failed:",s)}},I=s=>{s.syncProjectId&&j.push(`/projects/${s.syncProjectId}`)},V=async s=>{a.value=s,y.value=null,h.value=!0;try{const n=await q.getEventDetails(s.id);y.value=n.data}catch(n){U.error("Failed to load event details"),console.error("Load event details failed:",n)}},O=s=>({incremental_sync:F,full_sync:F,manual_sync:F,webhook_sync:F,status_change:fe,discovery:X})[s]||X,L=s=>({success:"success",running:"info",failed:"danger"})[s.toLowerCase()]||"info",C=s=>s.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),M=s=>s?new Date(s).toLocaleString():"-",T=s=>{if(!s)return"0s";if(s<1e3)return`${s}ms`;const n=Math.floor(s/1e3);if(n<60)return`${n}s`;const g=Math.floor(n/60),z=n%60;return`${g}m ${z}s`},P=()=>{_=window.setInterval(()=>{f(),i()},3e4)},K=()=>{_&&(clearInterval(_),_=null)},B=()=>{try{const s=["Time","Project","Event Type","Status","Message","Duration"],n=d.value.map(b=>[M(b.createdAt),b.projectKey,C(b.eventType),b.status,b.message||"",b.durationMs?T(b.durationMs):"-"]),g=[s.join(","),...n.map(b=>b.map(N=>`"${N}"`).join(","))].join(`
`),z=new Blob([g],{type:"text/csv;charset=utf-8;"}),D=document.createElement("a"),R=URL.createObjectURL(z);D.setAttribute("href",R),D.setAttribute("download",`sync_events_${new Date().toISOString().split("T")[0]}.csv`),D.style.visibility="hidden",document.body.appendChild(D),D.click(),document.body.removeChild(D),U.success(`Exported ${d.value.length} events`)}catch(s){U.error("Failed to export events"),console.error("Export failed:",s)}};return de(()=>{f(),i(),P()}),ie(()=>{K()}),(s,n)=>{const g=l("el-table-column"),z=l("FolderOpened"),D=l("el-icon"),R=l("el-tag"),b=l("el-button"),N=l("el-table"),Y=l("el-pagination"),Z=l("el-card"),k=l("el-descriptions-item"),ee=l("el-descriptions"),te=l("el-divider"),se=l("Loading"),ae=l("el-drawer"),ne=pe("loading");return S(),$("div",Re,[e(Ae,{stats:w.value},null,8,["stats"]),e(Le,{modelValue:ue(E),"onUpdate:modelValue":n[0]||(n[0]=c=>re(E)?E.value=c:E=c),onSearch:i,onExport:B},null,8,["modelValue"]),e(Z,{class:"table-card"},{default:t(()=>[_e((S(),A(N,{data:d.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(g,{prop:"createdAt",label:"Time",width:"180"},{default:t(({row:c})=>[v(r(M(c.createdAt)),1)]),_:1}),e(g,{prop:"projectKey",label:"Project","min-width":"200"},{default:t(({row:c})=>[o("div",Ue,[e(D,null,{default:t(()=>[e(z)]),_:1}),o("a",{onClick:le=>I(c),class:"project-link"},r(c.projectKey),9,Fe)])]),_:1}),e(g,{label:"Event Type",width:"160"},{default:t(({row:c})=>[o("div",Oe,[e(D,{size:16},{default:t(()=>[(S(),A(ve(O(c.eventType))))]),_:2},1024),o("span",null,r(C(c.eventType)),1)])]),_:1}),e(g,{label:"Status",width:"100"},{default:t(({row:c})=>[e(R,{type:L(c.status)},{default:t(()=>[v(r(c.status),1)]),_:2},1032,["type"])]),_:1}),e(g,{prop:"message",label:"Message","min-width":"200"}),e(g,{label:"Duration",width:"120"},{default:t(({row:c})=>[c.durationMs?(S(),$("span",Pe,r(T(c.durationMs)),1)):(S(),$("span",Ke,"-"))]),_:1}),e(g,{label:"Actions",width:"120",fixed:"right"},{default:t(({row:c})=>[e(b,{size:"small",onClick:le=>V(c)},{default:t(()=>[...n[4]||(n[4]=[v(" Detail ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,u.value]]),o("div",Be,[e(Y,{"current-page":m.page,"onUpdate:currentPage":n[1]||(n[1]=c=>m.page=c),"page-size":m.size,"onUpdate:pageSize":n[2]||(n[2]=c=>m.size=c),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])])]),_:1}),e(ae,{modelValue:h.value,"onUpdate:modelValue":n[3]||(n[3]=c=>h.value=c),title:"Event Detail",size:"50%",direction:"rtl"},{default:t(()=>[a.value?(S(),$("div",Ne,[e(ee,{column:1,border:""},{default:t(()=>[e(k,{label:"Event ID"},{default:t(()=>[v(r(a.value.id),1)]),_:1}),e(k,{label:"Project"},{default:t(()=>[v(r(a.value.projectKey),1)]),_:1}),e(k,{label:"Event Type"},{default:t(()=>[v(r(C(a.value.eventType)),1)]),_:1}),e(k,{label:"Status"},{default:t(()=>[e(R,{type:L(a.value.status)},{default:t(()=>[v(r(a.value.status),1)]),_:1},8,["type"])]),_:1}),e(k,{label:"Time"},{default:t(()=>[v(r(M(a.value.createdAt)),1)]),_:1}),a.value.durationMs?(S(),A(k,{key:0,label:"Duration"},{default:t(()=>[v(r(T(a.value.durationMs)),1)]),_:1})):Q("",!0)]),_:1}),e(te),n[6]||(n[6]=o("h3",null,"Event Details",-1)),y.value?(S(),$("div",Je,[o("pre",null,r(JSON.stringify(y.value,null,2)),1)])):(S(),$("div",qe,[e(D,{class:"is-loading"},{default:t(()=>[e(se)]),_:1}),n[5]||(n[5]=v(" Loading details... ",-1))]))])):Q("",!0)]),_:1},8,["modelValue"])])}}}),Qe=W(Ge,[["__scopeId","data-v-6c9e4e7a"]]);export{Qe as default};
