import{d as K,z as L,g as re,c as F,w as t,r as c,b as e,k as j,p as ce,F as de,A as ue,j as f,o as y,_ as T,m as ie,a as g,l as z,t as h,f as B,B as pe,h as fe,C as ye,D as me,E as m,G as he,H as _e,x as ge,y as $}from"./index-CzeBn7J5.js";import{c as P}from"./client-C0jSVIxo.js";const be=K({__name:"FilterBar",props:{groups:{},modelValue:{}},emits:["update:modelValue","search"],setup(o,{emit:V}){const _=o,v=V,n=L({group:_.modelValue.group||"",status:_.modelValue.status||"",syncMethod:_.modelValue.syncMethod||"",delayRange:_.modelValue.delayRange||"",search:_.modelValue.search||""});re(n,w=>{v("update:modelValue",{...w})});const M=()=>{v("search")},p=()=>{n.group="",n.status="",n.syncMethod="",n.delayRange="",n.search="",v("search")};return(w,r)=>{const d=c("el-option"),S=c("el-select"),u=c("el-form-item"),O=c("Search"),U=c("el-icon"),C=c("el-input"),x=c("el-button"),A=c("el-form"),N=c("el-card");return y(),F(N,{class:"filter-bar",shadow:"never"},{default:t(()=>[e(A,{inline:!0,model:n,class:"filter-form"},{default:t(()=>[e(u,{label:"Group"},{default:t(()=>[e(S,{modelValue:n.group,"onUpdate:modelValue":r[0]||(r[0]=i=>n.group=i),placeholder:"All Groups",clearable:"",style:{width:"180px"}},{default:t(()=>[(y(!0),j(de,null,ce(o.groups,i=>(y(),F(d,{key:i,label:i,value:i},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Status"},{default:t(()=>[e(S,{modelValue:n.status,"onUpdate:modelValue":r[1]||(r[1]=i=>n.status=i),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"Synced",value:"synced"}),e(d,{label:"Syncing",value:"syncing"}),e(d,{label:"Outdated",value:"outdated"}),e(d,{label:"Paused",value:"paused"}),e(d,{label:"Failed",value:"failed"}),e(d,{label:"Pending",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Sync Method"},{default:t(()=>[e(S,{modelValue:n.syncMethod,"onUpdate:modelValue":r[2]||(r[2]=i=>n.syncMethod=i),placeholder:"All Methods",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"Push Mirror",value:"push_mirror"}),e(d,{label:"Pull Sync",value:"pull_sync"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Delay Range"},{default:t(()=>[e(S,{modelValue:n.delayRange,"onUpdate:modelValue":r[3]||(r[3]=i=>n.delayRange=i),placeholder:"All Delays",clearable:"",style:{width:"150px"}},{default:t(()=>[e(d,{label:"< 1 hour",value:"0-3600"}),e(d,{label:"1-24 hours",value:"3600-86400"}),e(d,{label:"1-7 days",value:"86400-604800"}),e(d,{label:"> 7 days",value:"604800-"})]),_:1},8,["modelValue"])]),_:1}),e(u,{label:"Search"},{default:t(()=>[e(C,{modelValue:n.search,"onUpdate:modelValue":r[4]||(r[4]=i=>n.search=i),placeholder:"Project name or path",clearable:"",style:{width:"200px"},onKeyup:ue(M,["enter"])},{prefix:t(()=>[e(U,null,{default:t(()=>[e(O)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(u,null,{default:t(()=>[e(x,{type:"primary",onClick:M},{default:t(()=>[...r[5]||(r[5]=[f("Search",-1)])]),_:1}),e(x,{onClick:p},{default:t(()=>[...r[6]||(r[6]=[f("Reset",-1)])]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ve=T(be,[["__scopeId","data-v-c748c66c"]]),we={class:"diff-badge"},Se={class:"diff-item"},je={key:0,class:"diff-value new"},Ve={key:1,class:"diff-value deleted"},Ce={key:2,class:"diff-value outdated"},De={key:3,class:"diff-value synced"},Pe={key:0,class:"diff-item"},ke={class:"diff-value new"},Be=K({__name:"DiffBadge",props:{diff:{}},setup(o){const V=o,_=ie(()=>V.diff.branchNew>0||V.diff.branchDeleted>0||V.diff.branchOutdated>0);return(v,n)=>(y(),j("div",we,[g("div",Se,[n[0]||(n[0]=g("span",{class:"diff-label"},"Branches:",-1)),o.diff.branchNew>0?(y(),j("span",je,"+"+h(o.diff.branchNew),1)):z("",!0),o.diff.branchDeleted>0?(y(),j("span",Ve,"-"+h(o.diff.branchDeleted),1)):z("",!0),o.diff.branchOutdated>0?(y(),j("span",Ce,"~"+h(o.diff.branchOutdated),1)):z("",!0),_.value?z("",!0):(y(),j("span",De,"Synced"))]),o.diff.commitDiff>0?(y(),j("div",Pe,[n[1]||(n[1]=g("span",{class:"diff-label"},"Commits:",-1)),g("span",ke,"+"+h(o.diff.commitDiff),1)])):z("",!0)]))}}),ze=T(Be,[["__scopeId","data-v-40f6b2ec"]]),k={getProjects:o=>P.get("/sync/projects",{params:o}),getGroups:()=>P.get("/sync/projects/groups"),getProjectOverview:o=>P.get(`/sync/projects/${o}/overview`),batchSync:o=>P.post("/sync/projects/batch-sync",{projectIds:o}),batchPause:o=>P.post("/sync/projects/batch-pause",{projectIds:o}),batchResume:o=>P.post("/sync/projects/batch-resume",{projectIds:o}),batchDelete:o=>P.post("/sync/projects/batch-delete",{projectIds:o})},Me={class:"projects"},Re={class:"batch-content"},$e={class:"batch-info"},xe={class:"batch-actions"},Ae={class:"project-cell"},Fe=["onClick"],Oe={class:"pagination"},Ue=K({__name:"Projects",setup(o){const V=ge(),_=pe(),v=B(!1),n=B([]),M=B([]),p=B([]);let w=L({group:_.query.group||"",status:_.query.status||"",syncMethod:"",delayRange:"",search:""});const r=L({page:1,size:20,total:0}),d=B(""),S=B("asc"),u=async()=>{v.value=!0;try{const a={...w,page:r.page,size:r.size,sortBy:d.value,sortOrder:S.value},l=await k.getProjects(a);n.value=l.data.items,r.total=l.data.total}catch(a){m.error("Failed to load projects"),console.error("Load projects failed:",a)}finally{v.value=!1}},O=async()=>{try{const a=await k.getGroups();M.value=a.data}catch(a){console.error("Load groups failed:",a)}},U=a=>{p.value=a.map(l=>l.id)},C=()=>{p.value=[]},x=({prop:a,order:l})=>{l?(d.value=a,S.value=l==="ascending"?"asc":"desc"):(d.value="",S.value="asc"),u()},A=a=>{V.push(`/projects/${a.id}`)},N=async a=>{try{await $.confirm(`Are you sure to sync project "${a.projectKey}"?`,"Confirm Sync",{type:"warning"}),await k.batchSync([a.id]),m.success("Sync triggered successfully"),u()}catch(l){l!=="cancel"&&m.error("Failed to trigger sync")}},i=async()=>{try{await $.confirm(`Are you sure to sync ${p.value.length} projects?`,"Confirm Batch Sync",{type:"warning"}),await k.batchSync(p.value),m.success("Batch sync triggered successfully"),C(),u()}catch(a){a!=="cancel"&&m.error("Failed to trigger batch sync")}},H=async()=>{try{await $.confirm(`Are you sure to pause ${p.value.length} projects?`,"Confirm Batch Pause",{type:"warning"}),await k.batchPause(p.value),m.success("Projects paused successfully"),C(),u()}catch(a){a!=="cancel"&&m.error("Failed to pause projects")}},J=async()=>{try{await $.confirm(`Are you sure to resume ${p.value.length} projects?`,"Confirm Batch Resume",{type:"info"}),await k.batchResume(p.value),m.success("Projects resumed successfully"),C(),u()}catch(a){a!=="cancel"&&m.error("Failed to resume projects")}},Q=async()=>{try{await $.confirm(`Are you sure to delete ${p.value.length} projects? This action cannot be undone!`,"Confirm Batch Delete",{type:"error"}),await k.batchDelete(p.value),m.success("Projects deleted successfully"),C(),u()}catch(a){a!=="cancel"&&m.error("Failed to delete projects")}},W=a=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[a.toLowerCase()]||"info",X=a=>a<3600?"success":a<86400?"warning":"danger",Y=a=>a==="push_mirror"?"Push Mirror":"Pull Sync",E=a=>a?new Date(a).toLocaleString():"-";return fe(()=>{O(),u()}),(a,l)=>{const Z=c("Refresh"),R=c("el-icon"),D=c("el-button"),ee=c("VideoPause"),te=c("VideoPlay"),ae=c("Delete"),I=c("el-card"),b=c("el-table-column"),le=c("FolderOpened"),G=c("el-tag"),se=c("el-table"),oe=c("el-pagination"),ne=_e("loading");return y(),j("div",Me,[e(ve,{modelValue:me(w),"onUpdate:modelValue":l[0]||(l[0]=s=>ye(w)?w.value=s:w=s),groups:M.value,onSearch:u},null,8,["modelValue","groups"]),p.value.length>0?(y(),F(I,{key:0,class:"batch-bar",shadow:"never"},{default:t(()=>[g("div",Re,[g("span",$e,h(p.value.length)+" projects selected",1),g("div",xe,[e(D,{size:"small",onClick:i},{default:t(()=>[e(R,null,{default:t(()=>[e(Z)]),_:1}),l[3]||(l[3]=f(" Sync ",-1))]),_:1}),e(D,{size:"small",onClick:H},{default:t(()=>[e(R,null,{default:t(()=>[e(ee)]),_:1}),l[4]||(l[4]=f(" Pause ",-1))]),_:1}),e(D,{size:"small",onClick:J},{default:t(()=>[e(R,null,{default:t(()=>[e(te)]),_:1}),l[5]||(l[5]=f(" Resume ",-1))]),_:1}),e(D,{size:"small",type:"danger",onClick:Q},{default:t(()=>[e(R,null,{default:t(()=>[e(ae)]),_:1}),l[6]||(l[6]=f(" Delete ",-1))]),_:1}),e(D,{size:"small",onClick:C},{default:t(()=>[...l[7]||(l[7]=[f("Clear",-1)])]),_:1})])])]),_:1})):z("",!0),e(I,{class:"table-card"},{default:t(()=>[he((y(),F(se,{data:n.value,stripe:"",style:{width:"100%"},onSelectionChange:U,onSortChange:x},{default:t(()=>[e(b,{type:"selection",width:"55"}),e(b,{prop:"projectKey",label:"Project","min-width":"250",sortable:"custom"},{default:t(({row:s})=>[g("div",Ae,[e(R,null,{default:t(()=>[e(le)]),_:1}),g("a",{onClick:q=>A(s),class:"project-link"},h(s.projectKey),9,Fe)])]),_:1}),e(b,{label:"Status",width:"120"},{default:t(({row:s})=>[e(G,{type:W(s.syncStatus)},{default:t(()=>[f(h(s.syncStatus),1)]),_:2},1032,["type"])]),_:1}),e(b,{label:"Diff",width:"200"},{default:t(({row:s})=>[e(ze,{diff:s.diff},null,8,["diff"])]),_:1}),e(b,{label:"Delay",width:"120",sortable:"custom",prop:"delaySeconds"},{default:t(({row:s})=>[e(G,{type:X(s.delaySeconds)},{default:t(()=>[f(h(s.delayFormatted),1)]),_:2},1032,["type"])]),_:1}),e(b,{prop:"syncMethod",label:"Sync Method",width:"130"},{default:t(({row:s})=>[e(G,{type:"info",size:"small"},{default:t(()=>[f(h(Y(s.syncMethod)),1)]),_:2},1024)]),_:1}),e(b,{prop:"lastSyncAt",label:"Last Sync",width:"180",sortable:"custom"},{default:t(({row:s})=>[f(h(E(s.lastSyncAt)),1)]),_:1}),e(b,{prop:"updatedAt",label:"Updated",width:"180",sortable:"custom"},{default:t(({row:s})=>[f(h(E(s.updatedAt)),1)]),_:1}),e(b,{label:"Actions",width:"200",fixed:"right"},{default:t(({row:s})=>[e(D,{size:"small",onClick:q=>A(s)},{default:t(()=>[...l[8]||(l[8]=[f("Detail",-1)])]),_:1},8,["onClick"]),e(D,{size:"small",type:"primary",onClick:q=>N(s)},{default:t(()=>[...l[9]||(l[9]=[f("Sync",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,v.value]]),g("div",Oe,[e(oe,{"current-page":r.page,"onUpdate:currentPage":l[1]||(l[1]=s=>r.page=s),"page-size":r.size,"onUpdate:pageSize":l[2]||(l[2]=s=>r.size=s),total:r.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:u,onCurrentChange:u},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Le=T(Ue,[["__scopeId","data-v-6a19dd80"]]);export{Le as default};
