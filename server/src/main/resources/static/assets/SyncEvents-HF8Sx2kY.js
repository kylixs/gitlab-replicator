import{d as G,c as A,w as t,r as l,b as e,a as o,t as r,o as b,_ as H,f as x,z as q,g as le,A as oe,j as p,h as de,i as ce,k as $,C as ie,D as re,E as U,G as ue,H as _e,e as pe,l as W,x as me,I as Q,q as ve,J as F}from"./index-TlEndt19.js";import{e as J}from"./events-BvMTPhp8.js";import"./client-C0jSVIxo.js";const fe={class:"stat-item"},ye={class:"stat-icon primary"},he={class:"stat-info"},ge={class:"stat-value"},be={class:"stat-item"},Se={class:"stat-icon success"},we={class:"stat-info"},De={class:"stat-value"},Ee={class:"stat-item"},Ve={class:"stat-icon danger"},Te={class:"stat-info"},xe={class:"stat-value"},Ce={class:"stat-item"},ke={class:"stat-icon info"},$e={class:"stat-info"},je={class:"stat-value"},Me=G({__name:"EventStats",props:{stats:{}},setup(E){const j=u=>{if(!u)return"0s";if(u<1e3)return`${u}ms`;const c=Math.floor(u/1e3);if(c<60)return`${c}s`;const S=Math.floor(c/60),a=c%60;return`${S}m ${a}s`};return(u,c)=>{const S=l("List"),a=l("el-icon"),f=l("el-card"),y=l("el-col"),D=l("Check"),m=l("Close"),_=l("Timer"),i=l("el-row");return b(),A(i,{gutter:16,class:"event-stats"},{default:t(()=>[e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",fe,[o("div",ye,[e(a,{size:24},{default:t(()=>[e(S)]),_:1})]),o("div",he,[c[0]||(c[0]=o("div",{class:"stat-label"},"Total Events",-1)),o("div",ge,r(E.stats?.totalEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",be,[o("div",Se,[e(a,{size:24},{default:t(()=>[e(D)]),_:1})]),o("div",we,[c[1]||(c[1]=o("div",{class:"stat-label"},"Success",-1)),o("div",De,r(E.stats?.successEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",Ee,[o("div",Ve,[e(a,{size:24},{default:t(()=>[e(m)]),_:1})]),o("div",Te,[c[2]||(c[2]=o("div",{class:"stat-label"},"Failed",-1)),o("div",xe,r(E.stats?.failedEvents||0),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(f,{shadow:"hover"},{default:t(()=>[o("div",Ce,[o("div",ke,[e(a,{size:24},{default:t(()=>[e(_)]),_:1})]),o("div",$e,[c[3]||(c[3]=o("div",{class:"stat-label"},"Avg Duration",-1)),o("div",je,r(j(E.stats?.avgDurationMs)),1)])])]),_:1})]),_:1})]),_:1})}}}),ze=H(Me,[["__scopeId","data-v-dadfc410"]]),Ae=G({__name:"EventFilter",props:{modelValue:{}},emits:["update:modelValue","search","export"],setup(E,{emit:j}){const u=E,c=j,S=x(null),a=q({eventType:u.modelValue.eventType||"",status:u.modelValue.status||"",startDate:u.modelValue.startDate||"",endDate:u.modelValue.endDate||"",search:u.modelValue.search||""});le(a,_=>{c("update:modelValue",{..._})});const f=_=>{_&&_[0]&&_[1]?(a.startDate=_[0].toISOString().split("T")[0]||"",a.endDate=_[1].toISOString().split("T")[0]||""):(a.startDate="",a.endDate="")},y=()=>{c("search")},D=()=>{a.eventType="",a.status="",a.startDate="",a.endDate="",a.search="",S.value=null,c("search")},m=()=>{c("export")};return(_,i)=>{const v=l("el-option"),I=l("el-select"),V=l("el-form-item"),O=l("el-date-picker"),L=l("Search"),C=l("el-icon"),M=l("el-input"),T=l("el-button"),P=l("Download"),K=l("el-form"),B=l("el-card");return b(),A(B,{class:"event-filter",shadow:"never"},{default:t(()=>[e(K,{inline:!0,model:a,class:"filter-form"},{default:t(()=>[e(V,{label:"Event Type"},{default:t(()=>[e(I,{modelValue:a.eventType,"onUpdate:modelValue":i[0]||(i[0]=s=>a.eventType=s),placeholder:"All Types",clearable:"",style:{width:"180px"}},{default:t(()=>[e(v,{label:"Incremental Sync",value:"incremental_sync"}),e(v,{label:"Full Sync",value:"full_sync"}),e(v,{label:"Manual Sync",value:"manual_sync"}),e(v,{label:"Webhook Sync",value:"webhook_sync"}),e(v,{label:"Status Change",value:"status_change"}),e(v,{label:"Discovery",value:"discovery"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Status"},{default:t(()=>[e(I,{modelValue:a.status,"onUpdate:modelValue":i[1]||(i[1]=s=>a.status=s),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(v,{label:"Success",value:"success"}),e(v,{label:"Failed",value:"failed"}),e(v,{label:"Running",value:"running"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Date Range"},{default:t(()=>[e(O,{modelValue:S.value,"onUpdate:modelValue":i[2]||(i[2]=s=>S.value=s),type:"daterange","range-separator":"To","start-placeholder":"Start date","end-placeholder":"End date",style:{width:"280px"},onChange:f},null,8,["modelValue"])]),_:1}),e(V,{label:"Search"},{default:t(()=>[e(M,{modelValue:a.search,"onUpdate:modelValue":i[3]||(i[3]=s=>a.search=s),placeholder:"Project name",clearable:"",style:{width:"200px"},onKeyup:oe(y,["enter"])},{prefix:t(()=>[e(C,null,{default:t(()=>[e(L)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(T,{type:"primary",onClick:y},{default:t(()=>[...i[4]||(i[4]=[p("Search",-1)])]),_:1}),e(T,{onClick:D},{default:t(()=>[...i[5]||(i[5]=[p("Reset",-1)])]),_:1}),e(T,{onClick:m},{default:t(()=>[e(C,null,{default:t(()=>[e(P)]),_:1}),i[6]||(i[6]=p(" Export CSV ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),Ie=H(Ae,[["__scopeId","data-v-e0fc3d63"]]),Le={class:"sync-events"},Re={class:"project-cell"},Ue=["onClick"],Fe={class:"event-type-cell"},Oe={key:0},Pe={key:1},Ke={class:"pagination"},Be={key:0,class:"event-detail"},Ne={key:0,class:"event-details-json"},Je={key:1,class:"loading-details"},qe=G({__name:"SyncEvents",setup(E){const j=me(),u=x(!1),c=x([]),S=x(null),a=x(null),f=x(null),y=x(!1);let D=q({eventType:"",status:"",startDate:"",endDate:"",search:""});const m=q({page:1,size:20,total:0});let _=null;const i=async()=>{u.value=!0;try{const s={...D,page:m.page,size:m.size},n=await J.getEvents(s);c.value=n.data.items,m.total=n.data.total}catch(s){U.error("Failed to load events"),console.error("Load events failed:",s)}finally{u.value=!1}},v=async()=>{try{const s=new Date().toISOString().split("T")[0],n=await J.getEventStats(s);S.value=n.data}catch(s){console.error("Load stats failed:",s)}},I=s=>{s.syncProjectId&&j.push(`/projects/${s.syncProjectId}`)},V=async s=>{a.value=s,f.value=null,y.value=!0;try{const n=await J.getEventDetails(s.id);f.value=n.data}catch(n){U.error("Failed to load event details"),console.error("Load event details failed:",n)}},O=s=>({incremental_sync:F,full_sync:F,manual_sync:F,webhook_sync:F,status_change:ve,discovery:Q})[s]||Q,L=s=>({success:"success",running:"info",failed:"danger"})[s.toLowerCase()]||"info",C=s=>s.split("_").map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),M=s=>s?new Date(s).toLocaleString():"-",T=s=>{if(!s)return"0s";if(s<1e3)return`${s}ms`;const n=Math.floor(s/1e3);if(n<60)return`${n}s`;const h=Math.floor(n/60),z=n%60;return`${h}m ${z}s`},P=()=>{_=window.setInterval(()=>{v(),i()},3e4)},K=()=>{_&&(clearInterval(_),_=null)},B=()=>{try{const s=["Time","Project","Event Type","Status","Message","Duration"],n=c.value.map(g=>[M(g.createdAt),g.projectKey,C(g.eventType),g.status,g.message||"",g.durationMs?T(g.durationMs):"-"]),h=[s.join(","),...n.map(g=>g.map(N=>`"${N}"`).join(","))].join(`
`),z=new Blob([h],{type:"text/csv;charset=utf-8;"}),w=document.createElement("a"),R=URL.createObjectURL(z);w.setAttribute("href",R),w.setAttribute("download",`sync_events_${new Date().toISOString().split("T")[0]}.csv`),w.style.visibility="hidden",document.body.appendChild(w),w.click(),document.body.removeChild(w),U.success(`Exported ${c.value.length} events`)}catch(s){U.error("Failed to export events"),console.error("Export failed:",s)}};return de(()=>{v(),i(),P()}),ce(()=>{K()}),(s,n)=>{const h=l("el-table-column"),z=l("FolderOpened"),w=l("el-icon"),R=l("el-tag"),g=l("el-button"),N=l("el-table"),X=l("el-pagination"),Y=l("el-card"),k=l("el-descriptions-item"),Z=l("el-descriptions"),ee=l("el-divider"),te=l("Loading"),se=l("el-drawer"),ae=_e("loading");return b(),$("div",Le,[e(ze,{stats:S.value},null,8,["stats"]),e(Ie,{modelValue:re(D),"onUpdate:modelValue":n[0]||(n[0]=d=>ie(D)?D.value=d:D=d),onSearch:i,onExport:B},null,8,["modelValue"]),e(Y,{class:"table-card"},{default:t(()=>[ue((b(),A(N,{data:c.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(h,{prop:"createdAt",label:"Time",width:"180"},{default:t(({row:d})=>[p(r(M(d.createdAt)),1)]),_:1}),e(h,{prop:"projectKey",label:"Project","min-width":"200"},{default:t(({row:d})=>[o("div",Re,[e(w,null,{default:t(()=>[e(z)]),_:1}),o("a",{onClick:ne=>I(d),class:"project-link"},r(d.projectKey),9,Ue)])]),_:1}),e(h,{label:"Event Type",width:"160"},{default:t(({row:d})=>[o("div",Fe,[e(w,{size:16},{default:t(()=>[(b(),A(pe(O(d.eventType))))]),_:2},1024),o("span",null,r(C(d.eventType)),1)])]),_:1}),e(h,{label:"Status",width:"100"},{default:t(({row:d})=>[e(R,{type:L(d.status)},{default:t(()=>[p(r(d.status),1)]),_:2},1032,["type"])]),_:1}),e(h,{prop:"message",label:"Message","min-width":"200"}),e(h,{label:"Duration",width:"120"},{default:t(({row:d})=>[d.durationMs?(b(),$("span",Oe,r(T(d.durationMs)),1)):(b(),$("span",Pe,"-"))]),_:1}),e(h,{label:"Actions",width:"120",fixed:"right"},{default:t(({row:d})=>[e(g,{size:"small",onClick:ne=>V(d)},{default:t(()=>[...n[4]||(n[4]=[p(" Detail ",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,u.value]]),o("div",Ke,[e(X,{"current-page":m.page,"onUpdate:currentPage":n[1]||(n[1]=d=>m.page=d),"page-size":m.size,"onUpdate:pageSize":n[2]||(n[2]=d=>m.size=d),total:m.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:i,onCurrentChange:i},null,8,["current-page","page-size","total"])])]),_:1}),e(se,{modelValue:y.value,"onUpdate:modelValue":n[3]||(n[3]=d=>y.value=d),title:"Event Detail",size:"50%",direction:"rtl"},{default:t(()=>[a.value?(b(),$("div",Be,[e(Z,{column:1,border:""},{default:t(()=>[e(k,{label:"Event ID"},{default:t(()=>[p(r(a.value.id),1)]),_:1}),e(k,{label:"Project"},{default:t(()=>[p(r(a.value.projectKey),1)]),_:1}),e(k,{label:"Event Type"},{default:t(()=>[p(r(C(a.value.eventType)),1)]),_:1}),e(k,{label:"Status"},{default:t(()=>[e(R,{type:L(a.value.status)},{default:t(()=>[p(r(a.value.status),1)]),_:1},8,["type"])]),_:1}),e(k,{label:"Time"},{default:t(()=>[p(r(M(a.value.createdAt)),1)]),_:1}),a.value.durationMs?(b(),A(k,{key:0,label:"Duration"},{default:t(()=>[p(r(T(a.value.durationMs)),1)]),_:1})):W("",!0)]),_:1}),e(ee),n[6]||(n[6]=o("h3",null,"Event Details",-1)),f.value?(b(),$("div",Ne,[o("pre",null,r(JSON.stringify(f.value,null,2)),1)])):(b(),$("div",Je,[e(w,{class:"is-loading"},{default:t(()=>[e(te)]),_:1}),n[5]||(n[5]=p(" Loading details... ",-1))]))])):W("",!0)]),_:1},8,["modelValue"])])}}}),Qe=H(qe,[["__scopeId","data-v-6c9e4e7a"]]);export{Qe as default};
