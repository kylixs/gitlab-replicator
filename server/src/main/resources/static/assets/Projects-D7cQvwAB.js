import{d as J,z as H,g as re,c as O,w as t,r as n,b as e,k as j,p as ce,F as de,A as ue,j as i,o as _,_ as Q,m as ie,a as S,l as A,t as b,f as z,B as fe,h as pe,C as me,D as ye,E as h,G as he,H as _e,x as ge,y as $}from"./index-TlEndt19.js";import{p as P}from"./projects-Xszmq6dW.js";import"./client-C0jSVIxo.js";const be=J({__name:"FilterBar",props:{groups:{},modelValue:{}},emits:["update:modelValue","search","export"],setup(y,{emit:k}){const v=y,w=k,o=H({group:v.modelValue.group||"",status:v.modelValue.status||"",syncMethod:v.modelValue.syncMethod||"",delayRange:v.modelValue.delayRange||"",search:v.modelValue.search||""});re(o,g=>{w("update:modelValue",{...g})});const R=()=>{w("search")},f=()=>{o.group="",o.status="",o.syncMethod="",o.delayRange="",o.search="",w("search")},x=()=>{w("export")};return(g,r)=>{const c=n("el-option"),d=n("el-select"),V=n("el-form-item"),U=n("Search"),D=n("el-icon"),E=n("el-input"),M=n("el-button"),L=n("Download"),N=n("el-form"),K=n("el-card");return _(),O(K,{class:"filter-bar",shadow:"never"},{default:t(()=>[e(N,{inline:!0,model:o,class:"filter-form"},{default:t(()=>[e(V,{label:"Group"},{default:t(()=>[e(d,{modelValue:o.group,"onUpdate:modelValue":r[0]||(r[0]=u=>o.group=u),placeholder:"All Groups",clearable:"",style:{width:"180px"}},{default:t(()=>[(_(!0),j(de,null,ce(y.groups,u=>(_(),O(c,{key:u,label:u,value:u},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Status"},{default:t(()=>[e(d,{modelValue:o.status,"onUpdate:modelValue":r[1]||(r[1]=u=>o.status=u),placeholder:"All Status",clearable:"",style:{width:"150px"}},{default:t(()=>[e(c,{label:"Synced",value:"synced"}),e(c,{label:"Syncing",value:"syncing"}),e(c,{label:"Outdated",value:"outdated"}),e(c,{label:"Paused",value:"paused"}),e(c,{label:"Failed",value:"failed"}),e(c,{label:"Pending",value:"pending"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Sync Method"},{default:t(()=>[e(d,{modelValue:o.syncMethod,"onUpdate:modelValue":r[2]||(r[2]=u=>o.syncMethod=u),placeholder:"All Methods",clearable:"",style:{width:"150px"}},{default:t(()=>[e(c,{label:"Push Mirror",value:"push_mirror"}),e(c,{label:"Pull Sync",value:"pull_sync"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Delay Range"},{default:t(()=>[e(d,{modelValue:o.delayRange,"onUpdate:modelValue":r[3]||(r[3]=u=>o.delayRange=u),placeholder:"All Delays",clearable:"",style:{width:"150px"}},{default:t(()=>[e(c,{label:"< 1 hour",value:"0-3600"}),e(c,{label:"1-24 hours",value:"3600-86400"}),e(c,{label:"1-7 days",value:"86400-604800"}),e(c,{label:"> 7 days",value:"604800-"})]),_:1},8,["modelValue"])]),_:1}),e(V,{label:"Search"},{default:t(()=>[e(E,{modelValue:o.search,"onUpdate:modelValue":r[4]||(r[4]=u=>o.search=u),placeholder:"Project name or path",clearable:"",style:{width:"200px"},onKeyup:ue(R,["enter"])},{prefix:t(()=>[e(D,null,{default:t(()=>[e(U)]),_:1})]),_:1},8,["modelValue"])]),_:1}),e(V,null,{default:t(()=>[e(M,{type:"primary",onClick:R},{default:t(()=>[...r[5]||(r[5]=[i("Search",-1)])]),_:1}),e(M,{onClick:f},{default:t(()=>[...r[6]||(r[6]=[i("Reset",-1)])]),_:1}),e(M,{onClick:x},{default:t(()=>[e(D,null,{default:t(()=>[e(L)]),_:1}),r[7]||(r[7]=i(" Export CSV ",-1))]),_:1})]),_:1})]),_:1},8,["model"])]),_:1})}}}),ve=Q(be,[["__scopeId","data-v-1375c9f6"]]),Se={class:"diff-badge"},we={class:"diff-item"},Ce={key:0,class:"diff-value new"},Ve={key:1,class:"diff-value deleted"},De={key:2,class:"diff-value outdated"},je={key:3,class:"diff-value synced"},ke={key:0,class:"diff-item"},xe={class:"diff-value new"},Be=J({__name:"DiffBadge",props:{diff:{}},setup(y){const k=y,v=ie(()=>k.diff.branchNew>0||k.diff.branchDeleted>0||k.diff.branchOutdated>0);return(w,o)=>(_(),j("div",Se,[S("div",we,[o[0]||(o[0]=S("span",{class:"diff-label"},"Branches:",-1)),y.diff.branchNew>0?(_(),j("span",Ce,"+"+b(y.diff.branchNew),1)):A("",!0),y.diff.branchDeleted>0?(_(),j("span",Ve,"-"+b(y.diff.branchDeleted),1)):A("",!0),y.diff.branchOutdated>0?(_(),j("span",De,"~"+b(y.diff.branchOutdated),1)):A("",!0),v.value?A("",!0):(_(),j("span",je,"Synced"))]),y.diff.commitDiff>0?(_(),j("div",ke,[o[1]||(o[1]=S("span",{class:"diff-label"},"Commits:",-1)),S("span",xe,"+"+b(y.diff.commitDiff),1)])):A("",!0)]))}}),Pe=Q(Be,[["__scopeId","data-v-40f6b2ec"]]),Me={class:"projects"},ze={class:"batch-content"},Ae={class:"batch-info"},Re={class:"batch-actions"},$e={class:"project-cell"},Fe=["onClick"],Oe={class:"pagination"},Ue=J({__name:"Projects",setup(y){const k=ge(),v=fe(),w=z(!1),o=z([]),R=z([]),f=z([]);let x=H({group:v.query.group||"",status:v.query.status||"",syncMethod:"",delayRange:"",search:""});const g=H({page:1,size:20,total:0}),r=z(""),c=z("asc"),d=async()=>{w.value=!0;try{const a={...x,page:g.page,size:g.size,sortBy:r.value,sortOrder:c.value},l=await P.getProjects(a);o.value=l.data.items,g.total=l.data.total}catch(a){h.error("Failed to load projects"),console.error("Load projects failed:",a)}finally{w.value=!1}},V=async()=>{try{const a=await P.getGroups();R.value=a.data}catch(a){console.error("Load groups failed:",a)}},U=a=>{f.value=a.map(l=>l.id)},D=()=>{f.value=[]},E=({prop:a,order:l})=>{l?(r.value=a,c.value=l==="ascending"?"asc":"desc"):(r.value="",c.value="asc"),d()},M=a=>{k.push(`/projects/${a.id}`)},L=async a=>{try{await $.confirm(`Are you sure to sync project "${a.projectKey}"?`,"Confirm Sync",{type:"warning"}),await P.batchSync([a.id]),h.success("Sync triggered successfully"),d()}catch(l){l!=="cancel"&&h.error("Failed to trigger sync")}},N=async()=>{try{await $.confirm(`Are you sure to sync ${f.value.length} projects?`,"Confirm Batch Sync",{type:"warning"}),await P.batchSync(f.value),h.success("Batch sync triggered successfully"),D(),d()}catch(a){a!=="cancel"&&h.error("Failed to trigger batch sync")}},K=async()=>{try{await $.confirm(`Are you sure to pause ${f.value.length} projects?`,"Confirm Batch Pause",{type:"warning"}),await P.batchPause(f.value),h.success("Projects paused successfully"),D(),d()}catch(a){a!=="cancel"&&h.error("Failed to pause projects")}},u=async()=>{try{await $.confirm(`Are you sure to resume ${f.value.length} projects?`,"Confirm Batch Resume",{type:"info"}),await P.batchResume(f.value),h.success("Projects resumed successfully"),D(),d()}catch(a){a!=="cancel"&&h.error("Failed to resume projects")}},Z=async()=>{try{await $.confirm(`Are you sure to delete ${f.value.length} projects? This action cannot be undone!`,"Confirm Batch Delete",{type:"error"}),await P.batchDelete(f.value),h.success("Projects deleted successfully"),D(),d()}catch(a){a!=="cancel"&&h.error("Failed to delete projects")}},ee=a=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[a.toLowerCase()]||"info",te=a=>a<3600?"success":a<86400?"warning":"danger",W=a=>a==="push_mirror"?"Push Mirror":"Pull Sync",F=a=>a?new Date(a).toLocaleString():"-",ae=()=>{try{const a=["Project","Status","Branch New","Branch Deleted","Branch Outdated","Commit Diff","Delay","Sync Method","Last Sync","Updated"],l=o.value.map(m=>[m.projectKey,m.syncStatus,m.diff.branchNew.toString(),m.diff.branchDeleted.toString(),m.diff.branchOutdated.toString(),m.diff.commitDiff.toString(),m.delayFormatted,W(m.syncMethod),F(m.lastSyncAt),F(m.updatedAt)]),T=[a.join(","),...l.map(m=>m.map(I=>`"${I}"`).join(","))].join(`
`),B=new Blob([T],{type:"text/csv;charset=utf-8;"}),p=document.createElement("a"),G=URL.createObjectURL(B);p.setAttribute("href",G),p.setAttribute("download",`projects_${new Date().toISOString().split("T")[0]}.csv`),p.style.visibility="hidden",document.body.appendChild(p),p.click(),document.body.removeChild(p),h.success(`Exported ${o.value.length} projects`)}catch(a){h.error("Failed to export projects"),console.error("Export failed:",a)}};return pe(()=>{V(),d()}),(a,l)=>{const T=n("Refresh"),B=n("el-icon"),p=n("el-button"),G=n("VideoPause"),m=n("VideoPlay"),I=n("Delete"),X=n("el-card"),C=n("el-table-column"),le=n("FolderOpened"),q=n("el-tag"),oe=n("el-table"),se=n("el-pagination"),ne=_e("loading");return _(),j("div",Me,[e(ve,{modelValue:ye(x),"onUpdate:modelValue":l[0]||(l[0]=s=>me(x)?x.value=s:x=s),groups:R.value,onSearch:d,onExport:ae},null,8,["modelValue","groups"]),f.value.length>0?(_(),O(X,{key:0,class:"batch-bar",shadow:"never"},{default:t(()=>[S("div",ze,[S("span",Ae,b(f.value.length)+" projects selected",1),S("div",Re,[e(p,{size:"small",onClick:N},{default:t(()=>[e(B,null,{default:t(()=>[e(T)]),_:1}),l[3]||(l[3]=i(" Sync ",-1))]),_:1}),e(p,{size:"small",onClick:K},{default:t(()=>[e(B,null,{default:t(()=>[e(G)]),_:1}),l[4]||(l[4]=i(" Pause ",-1))]),_:1}),e(p,{size:"small",onClick:u},{default:t(()=>[e(B,null,{default:t(()=>[e(m)]),_:1}),l[5]||(l[5]=i(" Resume ",-1))]),_:1}),e(p,{size:"small",type:"danger",onClick:Z},{default:t(()=>[e(B,null,{default:t(()=>[e(I)]),_:1}),l[6]||(l[6]=i(" Delete ",-1))]),_:1}),e(p,{size:"small",onClick:D},{default:t(()=>[...l[7]||(l[7]=[i("Clear",-1)])]),_:1})])])]),_:1})):A("",!0),e(X,{class:"table-card"},{default:t(()=>[he((_(),O(oe,{data:o.value,stripe:"",style:{width:"100%"},onSelectionChange:U,onSortChange:E},{default:t(()=>[e(C,{type:"selection",width:"55"}),e(C,{prop:"projectKey",label:"Project","min-width":"250",sortable:"custom"},{default:t(({row:s})=>[S("div",$e,[e(B,null,{default:t(()=>[e(le)]),_:1}),S("a",{onClick:Y=>M(s),class:"project-link"},b(s.projectKey),9,Fe)])]),_:1}),e(C,{label:"Status",width:"120"},{default:t(({row:s})=>[e(q,{type:ee(s.syncStatus)},{default:t(()=>[i(b(s.syncStatus),1)]),_:2},1032,["type"])]),_:1}),e(C,{label:"Diff",width:"200"},{default:t(({row:s})=>[e(Pe,{diff:s.diff},null,8,["diff"])]),_:1}),e(C,{label:"Delay",width:"120",sortable:"custom",prop:"delaySeconds"},{default:t(({row:s})=>[e(q,{type:te(s.delaySeconds)},{default:t(()=>[i(b(s.delayFormatted),1)]),_:2},1032,["type"])]),_:1}),e(C,{prop:"syncMethod",label:"Sync Method",width:"130"},{default:t(({row:s})=>[e(q,{type:"info",size:"small"},{default:t(()=>[i(b(W(s.syncMethod)),1)]),_:2},1024)]),_:1}),e(C,{prop:"lastSyncAt",label:"Last Sync",width:"180",sortable:"custom"},{default:t(({row:s})=>[i(b(F(s.lastSyncAt)),1)]),_:1}),e(C,{prop:"updatedAt",label:"Updated",width:"180",sortable:"custom"},{default:t(({row:s})=>[i(b(F(s.updatedAt)),1)]),_:1}),e(C,{label:"Actions",width:"200",fixed:"right"},{default:t(({row:s})=>[e(p,{size:"small",onClick:Y=>M(s)},{default:t(()=>[...l[8]||(l[8]=[i("Detail",-1)])]),_:1},8,["onClick"]),e(p,{size:"small",type:"primary",onClick:Y=>L(s)},{default:t(()=>[...l[9]||(l[9]=[i("Sync",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ne,w.value]]),S("div",Oe,[e(se,{"current-page":g.page,"onUpdate:currentPage":l[1]||(l[1]=s=>g.page=s),"page-size":g.size,"onUpdate:pageSize":l[2]||(l[2]=s=>g.size=s),total:g.total,"page-sizes":[10,20,50,100],layout:"total, sizes, prev, pager, next, jumper",onSizeChange:d,onCurrentChange:d},null,8,["current-page","page-size","total"])])]),_:1})])}}}),Ke=Q(Ue,[["__scopeId","data-v-e006e351"]]);export{Ke as default};
