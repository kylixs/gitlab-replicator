import{d as O,k as w,b as e,r as n,w as t,a,j as d,t as o,o as _,_ as F,f as x,m as ae,h as G,G as X,H as Y,c as L,E as A,z as se,e as oe,I as H,q as ne,J as V,B as le,i as ie,l as J,D as Q,y as ce}from"./index-DUIPRFK_.js";import{p as W}from"./projects-vixqTZh8.js";import{e as de}from"./events-BvMTPhp8.js";import"./client-C0jSVIxo.js";const re={class:"overview-tab"},ue={class:"stat-item"},_e={class:"stat-icon success"},fe={class:"stat-info"},ve={class:"stat-item"},me={class:"stat-icon warning"},pe={class:"stat-info"},he={class:"stat-value"},ye={class:"stat-item"},ge={class:"stat-icon info"},be={class:"stat-info"},we={class:"stat-value"},Ce={class:"stat-item"},Se={class:"stat-icon primary"},je={class:"stat-info"},$e={class:"stat-value"},xe={class:"diff-item"},Te={class:"diff-value new"},ke={class:"diff-item"},De={class:"diff-value deleted"},ze={class:"diff-item"},Me={class:"diff-value outdated"},Be={class:"diff-item"},Ae={class:"diff-value new"},Le={class:"card-header"},Ie={class:"card-header"},Ne=O({__name:"OverviewTab",props:{overview:{}},setup(c){const T=m=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[m.toLowerCase()]||"info",h=m=>m?new Date(m).toLocaleString():"-";return(m,s)=>{const j=n("Check"),C=n("el-icon"),S=n("el-tag"),p=n("el-card"),y=n("el-col"),D=n("Timer"),u=n("Clock"),f=n("Calendar"),i=n("el-row"),l=n("el-descriptions-item"),g=n("el-descriptions");return _(),w("div",re,[e(i,{gutter:16,class:"status-cards"},{default:t(()=>[e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover"},{default:t(()=>[a("div",ue,[a("div",_e,[e(C,{size:24},{default:t(()=>[e(j)]),_:1})]),a("div",fe,[s[0]||(s[0]=a("div",{class:"stat-label"},"Status",-1)),e(S,{type:T(c.overview.project.syncStatus)},{default:t(()=>[d(o(c.overview.project.syncStatus),1)]),_:1},8,["type"])])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover"},{default:t(()=>[a("div",ve,[a("div",me,[e(C,{size:24},{default:t(()=>[e(D)]),_:1})]),a("div",pe,[s[1]||(s[1]=a("div",{class:"stat-label"},"Delay",-1)),a("div",he,o(c.overview.delay?.formatted||"-"),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover"},{default:t(()=>[a("div",ye,[a("div",ge,[e(C,{size:24},{default:t(()=>[e(u)]),_:1})]),a("div",be,[s[2]||(s[2]=a("div",{class:"stat-label"},"Last Sync",-1)),a("div",we,o(h(c.overview.project.lastSyncAt)),1)])])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover"},{default:t(()=>[a("div",Ce,[a("div",Se,[e(C,{size:24},{default:t(()=>[e(f)]),_:1})]),a("div",je,[s[3]||(s[3]=a("div",{class:"stat-label"},"Next Sync",-1)),a("div",$e,o(h(c.overview.nextSyncTime)),1)])])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16,class:"diff-stats"},{default:t(()=>[e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",xe,[s[4]||(s[4]=a("div",{class:"diff-label"},"New Branches",-1)),a("div",Te,"+"+o(c.overview.diff?.branchNew||0),1)])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",ke,[s[5]||(s[5]=a("div",{class:"diff-label"},"Deleted Branches",-1)),a("div",De,"-"+o(c.overview.diff?.branchDeleted||0),1)])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",ze,[s[6]||(s[6]=a("div",{class:"diff-label"},"Outdated Branches",-1)),a("div",Me,"~"+o(c.overview.diff?.branchOutdated||0),1)])]),_:1})]),_:1}),e(y,{xs:24,sm:12,md:6},{default:t(()=>[e(p,{shadow:"hover",class:"diff-card"},{default:t(()=>[a("div",Be,[s[7]||(s[7]=a("div",{class:"diff-label"},"Commit Diff",-1)),a("div",Ae,"+"+o(c.overview.diff?.commitDiff||0),1)])]),_:1})]),_:1})]),_:1}),e(i,{gutter:16,class:"project-info-row"},{default:t(()=>[e(y,{xs:24,md:12},{default:t(()=>[e(p,{shadow:"hover"},{header:t(()=>[a("div",Le,[s[9]||(s[9]=a("span",null,"Source Project",-1)),e(S,{type:"info",size:"small"},{default:t(()=>[...s[8]||(s[8]=[d("GitLab",-1)])]),_:1})])]),default:t(()=>[e(g,{column:1,border:""},{default:t(()=>[e(l,{label:"Project ID"},{default:t(()=>[d(o(c.overview.source?.id),1)]),_:1}),e(l,{label:"Name"},{default:t(()=>[d(o(c.overview.source?.name),1)]),_:1}),e(l,{label:"Path"},{default:t(()=>[d(o(c.overview.source?.pathWithNamespace),1)]),_:1}),e(l,{label:"Default Branch"},{default:t(()=>[d(o(c.overview.source?.defaultBranch),1)]),_:1}),e(l,{label:"Last Activity"},{default:t(()=>[d(o(h(c.overview.source?.lastActivityAt)),1)]),_:1}),e(l,{label:"Commit Count"},{default:t(()=>[d(o(c.overview.source?.commitCount||"-"),1)]),_:1})]),_:1})]),_:1})]),_:1}),e(y,{xs:24,md:12},{default:t(()=>[e(p,{shadow:"hover"},{header:t(()=>[a("div",Ie,[s[11]||(s[11]=a("span",null,"Target Project",-1)),e(S,{type:"success",size:"small"},{default:t(()=>[...s[10]||(s[10]=[d("GitLab",-1)])]),_:1})])]),default:t(()=>[e(g,{column:1,border:""},{default:t(()=>[e(l,{label:"Project ID"},{default:t(()=>[d(o(c.overview.target?.id),1)]),_:1}),e(l,{label:"Name"},{default:t(()=>[d(o(c.overview.target?.name),1)]),_:1}),e(l,{label:"Path"},{default:t(()=>[d(o(c.overview.target?.pathWithNamespace),1)]),_:1}),e(l,{label:"Default Branch"},{default:t(()=>[d(o(c.overview.target?.defaultBranch),1)]),_:1}),e(l,{label:"Last Activity"},{default:t(()=>[d(o(h(c.overview.target?.lastActivityAt)),1)]),_:1}),e(l,{label:"Commit Count"},{default:t(()=>[d(o(c.overview.target?.commitCount||"-"),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),e(p,{shadow:"hover",class:"sync-config"},{header:t(()=>[...s[12]||(s[12]=[a("span",null,"Sync Configuration",-1)])]),default:t(()=>[e(g,{column:2,border:""},{default:t(()=>[e(l,{label:"Sync Method"},{default:t(()=>[e(S,{type:"info"},{default:t(()=>[d(o(c.overview.project.syncMethod==="push_mirror"?"Push Mirror":"Pull Sync"),1)]),_:1})]),_:1}),e(l,{label:"Created At"},{default:t(()=>[d(o(h(c.overview.project.createdAt)),1)]),_:1}),e(l,{label:"Updated At"},{default:t(()=>[d(o(h(c.overview.project.updatedAt)),1)]),_:1}),e(l,{label:"Last Sync At"},{default:t(()=>[d(o(h(c.overview.project.lastSyncAt)),1)]),_:1})]),_:1})]),_:1})])}}}),Pe=F(Ne,[["__scopeId","data-v-70d3a06d"]]),Ee={class:"branches-tab"},Ve={class:"stat-item"},Oe={class:"stat-icon success"},Fe={class:"stat-info"},Re={class:"stat-value"},Ue={class:"stat-item"},Ke={class:"stat-icon warning"},We={class:"stat-info"},Ge={class:"stat-value"},qe={class:"stat-item"},He={class:"stat-icon danger"},Je={class:"stat-info"},Qe={class:"stat-value"},Xe={class:"stat-item"},Ye={class:"stat-icon info"},Ze={class:"stat-info"},et={class:"stat-value"},tt={class:"branch-name"},at={key:0,class:"commit-info"},st={class:"commit-hash"},ot={class:"commit-count"},nt={key:1,class:"not-available"},lt={key:0,class:"commit-info"},it={class:"commit-hash"},ct={class:"commit-count"},dt={key:1,class:"not-available"},rt={key:0,class:"commit-diff"},ut={key:0,class:"diff-positive"},_t={key:1,class:"diff-negative"},ft={key:2,class:"diff-zero"},vt={key:1,class:"not-available"},mt={key:1,class:"not-available"},pt=O({__name:"BranchesTab",props:{projectId:{}},setup(c){const T=c,h=x(!1),m=x(null),s=x(""),j=x(""),C=async()=>{h.value=!0;try{const i=await W.getBranchComparison({syncProjectId:T.projectId});m.value=i.data}catch(i){A.error("Failed to load branch comparison"),console.error("Load branches failed:",i)}finally{h.value=!1}},S=ae(()=>{if(!m.value)return[];let i=m.value.branches||[];if(s.value&&(i=i.filter(l=>l.syncStatus===s.value)),j.value){const l=j.value.toLowerCase();i=i.filter(g=>g.branchName.toLowerCase().includes(l))}return i}),p=()=>{},y=i=>({synced:"success",outdated:"warning",missing_in_target:"danger",extra_in_target:"info"})[i]||"info",D=i=>({synced:"Synced",outdated:"Outdated",missing_in_target:"Missing",extra_in_target:"Extra"})[i]||i,u=i=>!i||i<3600?"success":i<86400?"warning":"danger",f=i=>i?new Date(i).toLocaleString():"-";return G(()=>{C()}),(i,l)=>{const g=n("Check"),v=n("el-icon"),$=n("el-card"),k=n("el-col"),b=n("Warning"),B=n("Close"),R=n("Plus"),N=n("el-row"),z=n("el-option"),P=n("el-select"),E=n("el-form-item"),I=n("Search"),U=n("el-input"),K=n("el-form"),Z=n("Branch"),M=n("el-table-column"),q=n("el-tag"),ee=n("el-table"),te=Y("loading");return _(),w("div",Ee,[e(N,{gutter:16,class:"branch-stats"},{default:t(()=>[e(k,{xs:24,sm:12,"md:":6},{default:t(()=>[e($,{shadow:"hover"},{default:t(()=>[a("div",Ve,[a("div",Oe,[e(v,{size:24},{default:t(()=>[e(g)]),_:1})]),a("div",Fe,[l[2]||(l[2]=a("div",{class:"stat-label"},"Synced",-1)),a("div",Re,o(m.value?.syncedCount||0),1)])])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e($,{shadow:"hover"},{default:t(()=>[a("div",Ue,[a("div",Ke,[e(v,{size:24},{default:t(()=>[e(b)]),_:1})]),a("div",We,[l[3]||(l[3]=a("div",{class:"stat-label"},"Outdated",-1)),a("div",Ge,o(m.value?.outdatedCount||0),1)])])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e($,{shadow:"hover"},{default:t(()=>[a("div",qe,[a("div",He,[e(v,{size:24},{default:t(()=>[e(B)]),_:1})]),a("div",Je,[l[4]||(l[4]=a("div",{class:"stat-label"},"Missing",-1)),a("div",Qe,o(m.value?.missingInTargetCount||0),1)])])]),_:1})]),_:1}),e(k,{xs:24,sm:12,md:6},{default:t(()=>[e($,{shadow:"hover"},{default:t(()=>[a("div",Xe,[a("div",Ye,[e(v,{size:24},{default:t(()=>[e(R)]),_:1})]),a("div",Ze,[l[5]||(l[5]=a("div",{class:"stat-label"},"Extra",-1)),a("div",et,o(m.value?.extraInTargetCount||0),1)])])]),_:1})]),_:1})]),_:1}),e($,{shadow:"never",class:"filter-bar"},{default:t(()=>[e(K,{inline:!0},{default:t(()=>[e(E,{label:"Status"},{default:t(()=>[e(P,{modelValue:s.value,"onUpdate:modelValue":l[0]||(l[0]=r=>s.value=r),placeholder:"All Status",clearable:"",style:{width:"180px"},onChange:p},{default:t(()=>[e(z,{label:"Synced",value:"synced"}),e(z,{label:"Outdated",value:"outdated"}),e(z,{label:"Missing in Target",value:"missing_in_target"}),e(z,{label:"Extra in Target",value:"extra_in_target"})]),_:1},8,["modelValue"])]),_:1}),e(E,{label:"Search"},{default:t(()=>[e(U,{modelValue:j.value,"onUpdate:modelValue":l[1]||(l[1]=r=>j.value=r),placeholder:"Branch name",clearable:"",style:{width:"200px"},onInput:p},{prefix:t(()=>[e(v,null,{default:t(()=>[e(I)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1})]),_:1}),e($,{shadow:"hover",class:"branches-table"},{default:t(()=>[X((_(),L(ee,{data:S.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(M,{prop:"branchName",label:"Branch","min-width":"200"},{default:t(({row:r})=>[a("div",tt,[e(v,null,{default:t(()=>[e(Z)]),_:1}),a("span",null,o(r.branchName),1)])]),_:1}),e(M,{label:"Status",width:"150"},{default:t(({row:r})=>[e(q,{type:y(r.syncStatus)},{default:t(()=>[d(o(D(r.syncStatus)),1)]),_:2},1032,["type"])]),_:1}),e(M,{label:"Source Commit",width:"200"},{default:t(({row:r})=>[r.sourceCommitShort?(_(),w("div",at,[a("code",st,o(r.sourceCommitShort),1),a("div",ot,o(r.sourceCommitCount||0)+" commits",1)])):(_(),w("span",nt,"-"))]),_:1}),e(M,{label:"Target Commit",width:"200"},{default:t(({row:r})=>[r.targetCommitShort?(_(),w("div",lt,[a("code",it,o(r.targetCommitShort),1),a("div",ct,o(r.targetCommitCount||0)+" commits",1)])):(_(),w("span",dt,"-"))]),_:1}),e(M,{label:"Commit Diff",width:"120"},{default:t(({row:r})=>[r.commitDiff!==void 0&&r.commitDiff!==null?(_(),w("span",rt,[r.commitDiff>0?(_(),w("span",ut,"+"+o(r.commitDiff),1)):r.commitDiff<0?(_(),w("span",_t,o(r.commitDiff),1)):(_(),w("span",ft,"0"))])):(_(),w("span",vt,"-"))]),_:1}),e(M,{label:"Delay",width:"120"},{default:t(({row:r})=>[r.delayFormatted?(_(),L(q,{key:0,type:u(r.delaySeconds)},{default:t(()=>[d(o(r.delayFormatted),1)]),_:2},1032,["type"])):(_(),w("span",mt,"-"))]),_:1}),e(M,{label:"Last Commit Time",width:"180"},{default:t(({row:r})=>[d(o(f(r.sourceLastCommitAt)),1)]),_:1})]),_:1},8,["data"])),[[te,h.value]])]),_:1})])}}}),ht=F(pt,[["__scopeId","data-v-ed95dfba"]]),yt={class:"events-tab"},gt={class:"event-type-cell"},bt={key:0},wt={key:1},Ct={class:"pagination"},St=O({__name:"EventsTab",props:{projectId:{},projectKey:{}},setup(c){const T=c,h=x(!1),m=x([]),s=se({page:1,size:20,total:0}),j=async()=>{h.value=!0;try{const u=await de.getEvents({search:T.projectKey,page:s.page,size:s.size});m.value=u.data.items.filter(f=>f.projectKey===T.projectKey),s.total=m.value.length}catch(u){A.error("Failed to load events"),console.error("Load events failed:",u)}finally{h.value=!1}},C=u=>({incremental_sync:V,full_sync:V,manual_sync:V,webhook_sync:V,status_change:ne,discovery:H})[u]||H,S=u=>({success:"success",running:"info",failed:"danger"})[u.toLowerCase()]||"info",p=u=>u.split("_").map(f=>f.charAt(0).toUpperCase()+f.slice(1)).join(" "),y=u=>u?new Date(u).toLocaleString():"-",D=u=>{if(!u)return"0s";if(u<1e3)return`${u}ms`;const f=Math.floor(u/1e3);if(f<60)return`${f}s`;const i=Math.floor(f/60),l=f%60;return`${i}m ${l}s`};return G(()=>{j()}),(u,f)=>{const i=n("el-table-column"),l=n("el-icon"),g=n("el-tag"),v=n("el-table"),$=n("el-pagination"),k=Y("loading");return _(),w("div",yt,[X((_(),L(v,{data:m.value,stripe:"",style:{width:"100%"}},{default:t(()=>[e(i,{prop:"createdAt",label:"Time",width:"180"},{default:t(({row:b})=>[d(o(y(b.createdAt)),1)]),_:1}),e(i,{label:"Event Type",width:"160"},{default:t(({row:b})=>[a("div",gt,[e(l,{size:16},{default:t(()=>[(_(),L(oe(C(b.eventType))))]),_:2},1024),a("span",null,o(p(b.eventType)),1)])]),_:1}),e(i,{label:"Status",width:"100"},{default:t(({row:b})=>[e(g,{type:S(b.status)},{default:t(()=>[d(o(b.status),1)]),_:2},1032,["type"])]),_:1}),e(i,{prop:"message",label:"Message","min-width":"200"}),e(i,{label:"Duration",width:"120"},{default:t(({row:b})=>[b.durationMs?(_(),w("span",bt,o(D(b.durationMs)),1)):(_(),w("span",wt,"-"))]),_:1})]),_:1},8,["data"])),[[k,h.value]]),a("div",Ct,[e($,{"current-page":s.page,"onUpdate:currentPage":f[0]||(f[0]=b=>s.page=b),"page-size":s.size,"onUpdate:pageSize":f[1]||(f[1]=b=>s.size=b),total:s.total,"page-sizes":[10,20,50],layout:"total, sizes, prev, pager, next",onSizeChange:j,onCurrentChange:j},null,8,["current-page","page-size","total"])])])}}}),jt=F(St,[["__scopeId","data-v-3c6bfe63"]]),$t={class:"project-detail"},xt={class:"header-content"},Tt={class:"project-info"},kt={class:"action-buttons"},Dt={key:0,class:"loading-container"},zt=O({__name:"ProjectDetail",setup(c){const T=le(),h=Number(T.params.id),m=x(!1),s=x(!1),j=x("overview"),C=x(null),S=x("");let p=null;const y=async()=>{m.value=!0;try{const g=await W.getProjectOverview(h);C.value=g.data,S.value=g.data.project.projectKey}catch(g){A.error("Failed to load project overview"),console.error("Load overview failed:",g)}finally{m.value=!1}},D=async()=>{try{await ce.confirm(`Are you sure to sync project "${S.value}"?`,"Confirm Sync",{type:"warning"}),s.value=!0,await W.batchSync([h]),A.success("Sync triggered successfully"),setTimeout(()=>y(),2e3)}catch(g){g!=="cancel"&&A.error("Failed to trigger sync")}finally{s.value=!1}},u=()=>{y(),A.success("Refreshed")},f=g=>({synced:"success",syncing:"info",outdated:"warning",paused:"info",failed:"danger",pending:"warning"})[g.toLowerCase()]||"info",i=()=>{p=window.setInterval(()=>{y()},3e4)},l=()=>{p&&(clearInterval(p),p=null)};return G(()=>{y(),i()}),ie(()=>{l()}),(g,v)=>{const $=n("el-breadcrumb-item"),k=n("el-breadcrumb"),b=n("FolderOpened"),B=n("el-icon"),R=n("el-tag"),N=n("Refresh"),z=n("el-button"),P=n("el-card"),E=n("Loading"),I=n("el-tab-pane"),U=n("el-tabs");return _(),w("div",$t,[e(k,{class:"breadcrumb",separator:"/"},{default:t(()=>[e($,{to:{path:"/"}},{default:t(()=>[...v[1]||(v[1]=[d("Dashboard",-1)])]),_:1}),e($,{to:{path:"/projects"}},{default:t(()=>[...v[2]||(v[2]=[d("Projects",-1)])]),_:1}),e($,null,{default:t(()=>[d(o(S.value),1)]),_:1})]),_:1}),e(P,{class:"header-card",shadow:"never"},{default:t(()=>[a("div",xt,[a("div",Tt,[e(B,{size:32},{default:t(()=>[e(b)]),_:1}),a("div",null,[a("h2",null,o(S.value),1),C.value?(_(),L(R,{key:0,type:f(C.value.project.syncStatus)},{default:t(()=>[d(o(C.value.project.syncStatus),1)]),_:1},8,["type"])):J("",!0)])]),a("div",kt,[e(z,{loading:s.value,onClick:D},{default:t(()=>[e(B,null,{default:t(()=>[e(N)]),_:1}),v[3]||(v[3]=d(" Sync Now ",-1))]),_:1},8,["loading"]),e(z,{onClick:u},{default:t(()=>[e(B,null,{default:t(()=>[e(N)]),_:1}),v[4]||(v[4]=d(" Refresh ",-1))]),_:1})])])]),_:1}),m.value?(_(),w("div",Dt,[e(B,{class:"is-loading",size:48},{default:t(()=>[e(E)]),_:1}),v[5]||(v[5]=a("p",null,"Loading project details...",-1))])):C.value?(_(),L(P,{key:1,class:"tabs-card"},{default:t(()=>[e(U,{modelValue:j.value,"onUpdate:modelValue":v[0]||(v[0]=K=>j.value=K)},{default:t(()=>[e(I,{label:"Overview",name:"overview"},{default:t(()=>[e(Pe,{overview:C.value},null,8,["overview"])]),_:1}),e(I,{label:"Branches",name:"branches"},{default:t(()=>[e(ht,{"project-id":Q(h)},null,8,["project-id"])]),_:1}),e(I,{label:"Sync Events",name:"events"},{default:t(()=>[e(jt,{"project-id":Q(h),"project-key":S.value},null,8,["project-id","project-key"])]),_:1})]),_:1},8,["modelValue"])]),_:1})):J("",!0)])}}}),It=F(zt,[["__scopeId","data-v-d62a7fc0"]]);export{It as default};
